<!DOCTYPE html>
<html lang="en">

<head>
    <title>Hydra</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="./css/reset.css">
    <!-- <link rel="stylesheet" href="./css/hydra.css"> -->
    <!-- <link rel="stylesheet" href="./css/high-contrast.css"> -->
    <style>
        html {
            height: 100%;
            width: 100%;
        }

        body {
            margin: 0;
            width: 100%;
            height: 100%;
            background: #070a0a;
            color: white;
            font-family: sans-serif;
        }

        * {
            box-sizing: border-box;
            cursor: default;
        }

        #hydra {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            width: 80%;
            max-width: 1920px;
            margin: auto;
            border-left: solid 1px #1c1c1c;
        }

        .deck-screen {
            aspect-ratio: 16/9;
            background: #0f1313;
            position: relative;
        }

        .canvas {
            aspect-ratio: 16/9;
            width: 100%;
            height: 100%;
            background: black;
            border: solid 1px #272727;
        }

        .section {
            width: 100%;
            display: flex;
            background: black;
            border-top: solid 1px #1b1b1b;
            border-bottom: solid 1px #03030394;
        }

        .extend {
            flex: 1 1 auto;
        }

        .scroll-overflow-y {
            overflow-y: auto;
        }

        .column {
            background: #0f1313;
            border-left: solid 1px #1b1b1b;
            border-right: solid 1px #03030394;
            padding: 10px;
            position: relative;
            display: flex;
            flex-basis: 33.333333%;
            flex-grow: 0;
            flex-shrink: 0;
        }

        .column:not(.dropdowns) {
            flex-direction: column;
        }

        #crossfader-section {
            align-items: center;
            display: flex;
            justify-content: center;
        }

        #crossfader-container {
            width: 100%;
        }

        #crossfader {
            width: 100%;
        }

        .lcd-screen {
            background: #0d0d0d;
            box-sizing: border-box;
            border: solid 1px #1a2019;
            padding: 10px;
            border-radius: 2px;
            display: flex;
            justify-content: space-between;
            width: 100%;
        }

        .readout {
            text-transform: uppercase;
            font-size: 11px;
            color: #b2c2ad;
            font-weight: 600;
        }

        .label {
            opacity: 0.4;
        }

        .preset-btns {
            text-transform: uppercase;
            font-size: 11px;
            color: #a1a1a1;
            font-weight: 600;
            background: #181818;
            border: solid 1px #515151;
            padding: 15px 0;
            border-radius: 0px;
            cursor: pointer;
            width: 100%;
        }

        .preset-btns:hover {
            background: #2a2a2a;
        }

        button {
            width: 100%;
            margin-top: 10px;
            border: solid 1px #2b2b2b;
            background: transparent;
            padding: 10px;
            color: #8d8d8d;
            text-transform: uppercase;
            font-weight: 800;
            border-radius: 2px;
            font-size: 11px;
            cursor: pointer;
            transition: all ease 100ms;
        }

        button:hover {
            color: white;
        }

        button:focus-visible {
            outline: none;
        }

        button.on {
            background: #b1b1b1;
            color: black;
        }

        button.green {
            background: #23e648;
            color: black;
        }

        button.green:active {
            background: #3aff5e;
            color: black;
        }

        button.pink {
            background: #e623ad;
            color: black;
        }

        button.pink:active {
            background: #fb2ebd;
            color: black;
        }

        button.blue {
            background: #23c2e6;
            color: black;
        }

        button.blue:active {
            background: #36daff;
            color: black;
        }

        button.yellow {
            background: #e4e623;
            color: black;
        }

        button.yellow:active {
            background: #fcff4b;
            color: black;
        }

        button.orange {
            background: #e67423;
            color: black;
        }

        button.orange:active {
            background: #ff8b39;
            color: black;
        }

        button.red {
            background: #e62323;
            color: white;
        }

        button.red:active {
            background: #ff3535;
            color: white;
        }

        button.raise-to-top {
            width: 35px;
            height: 35px;
            margin-top: 16px;
            background: transparent;
            color: white;
            line-height: 0;
        }

        button.raise-to-top.raised {
            background: #23e648;
            color: black;
        }

        button.raise-to-top:hover {
            background: #23e648;
            color: black;
        }

        button.reset {
            width: 35px;
            margin-top: 16px;
            background: #e62323;
            color: white;
            height: 35px;
            line-height: 0;
        }

        button:disabled {
            opacity: 0.2;
            cursor: not-allowed;
        }

        .button-group,
        .main-mixer-panel-group {
            display: flex;
        }

        .button-group:not(.button-radio-switch-group),
        .main-mixer-panel-group {
            gap: 10px;
        }

        .button-group > div,
        .main-mixer-panel-group > div {
            width: 100%;
        }

        .button-radio-switch-group > div:first-of-type button {
            border-radius: 2px 0 0 2px;
        }

        .button-radio-switch-group > div:last-of-type button {
            border-radius: 0 2px 2px 0;
        }

        .button-radio-switch-group > div:not(:first-of-type):not(:last-of-type) button {
            border-radius: 0;
            border-left: none;
            border-right: none;
        }

        .button-radio-switch-group button {
            margin-top: 0;
        }

        .main-mixer-panel-group {
            padding-top: 40px;
        }

        .main-mixer-panel-group .deck-1 {
            text-align: right;
        }

        .main-mixer-panel-group .presets.saving-preset .preset {
            -webkit-animation: backgroundBlink 1s step-end infinite;
            animation: backgroundBlink 1s step-end infinite;
        }
        .main-mixer-panel-group .presets.saving-preset .preset:hover {
            background: rgba(0,240,255,1) !important;
        }

        .main-mixer-panel-group .presets button {
            padding: 5px 0;
        }

        .main-mixer-panel-group .presets button:nth-of-type(1) {
            background: rgba(240,0,255,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(1):hover,
        .main-mixer-panel-group .presets button:nth-of-type(1).active {
            background: rgba(240,0,255,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(2) {
            background: rgba(150,0,255,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(2):hover,
        .main-mixer-panel-group .presets button:nth-of-type(2).active {
            background: rgba(150,0,255,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(3) {
            background: rgba(60,0,255,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(3):hover,
        .main-mixer-panel-group .presets button:nth-of-type(3).active {
            background: rgba(60,0,255,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(4) {
            background: rgba(0,0,255,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(4):hover,
        .main-mixer-panel-group .presets button:nth-of-type(4).active {
            background: rgba(0,0,255,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(5) {
            background: rgba(0,60,255,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(5):hover,
        .main-mixer-panel-group .presets button:nth-of-type(5).active {
            background: rgba(0,60,255,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(6) {
            background: rgba(0,120,255,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(6):hover,
        .main-mixer-panel-group .presets button:nth-of-type(6).active {
            background: rgba(0,120,255,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(7) {
            background: rgba(0,180,255,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(7):hover,
        .main-mixer-panel-group .presets button:nth-of-type(7).active {
            background: rgba(0,180,255,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(8) {
            background: rgba(0,240,255,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(8):hover,
        .main-mixer-panel-group .presets button:nth-of-type(8).active {
            background: rgba(0,240,255,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(9) {
            background: rgba(0,255,210,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(9):hover,
        .main-mixer-panel-group .presets button:nth-of-type(9).active {
            background: rgba(0,255,210,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(10) {
            background: rgba(0,255,150,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(10):hover,
        .main-mixer-panel-group .presets button:nth-of-type(10).active {
            background: rgba(0,255,150,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(11) {
            background: rgba(0,255,90,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(11):hover,
        .main-mixer-panel-group .presets button:nth-of-type(11).active {
            background: rgba(0,255,90,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(12) {
            background: rgba(0,255,30,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(12):hover,
        .main-mixer-panel-group .presets button:nth-of-type(12).active {
            background: rgba(0,255,30,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(13) {
            background: rgba(30,255,0,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(13):hover,
        .main-mixer-panel-group .presets button:nth-of-type(13).active {
            background: rgba(30,255,0,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(14) {
            background: rgba(90,255,0,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(14):hover,
        .main-mixer-panel-group .presets button:nth-of-type(14).active {
            background: rgba(90,255,0,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(15) {
            background: rgba(150,255,0,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(15):hover,
        .main-mixer-panel-group .presets button:nth-of-type(15).active {
            background: rgba(150,255,0,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(16) {
            background: rgba(210,255,0,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(16):hover,
        .main-mixer-panel-group .presets button:nth-of-type(16).active {
            background: rgba(210,255,0,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(17) {
            background: rgba(255,230,0,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(17):hover,
        .main-mixer-panel-group .presets button:nth-of-type(17).active {
            background: rgba(255,230,0,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(18) {
            background: rgba(255,170,0,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(18):hover,
        .main-mixer-panel-group .presets button:nth-of-type(18).active {
            background: rgba(255,170,0,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(19) {
            background: rgba(255,110,0,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(19):hover,
        .main-mixer-panel-group .presets button:nth-of-type(19).active {
            background: rgba(255,110,0,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(20) {
            background: rgba(255,50,0,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(20):hover,
        .main-mixer-panel-group .presets button:nth-of-type(20).active {
            background: rgba(255,50,0,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(21) {
            background: rgba(255,0,10,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(21):hover,
        .main-mixer-panel-group .presets button:nth-of-type(21).active {
            background: rgba(255,0,10,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(22) {
            background: rgba(255,0,70,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(22):hover,
        .main-mixer-panel-group .presets button:nth-of-type(22).active {
            background: rgba(255,0,70,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(23) {
            background: rgba(255,0,130,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(23):hover,
        .main-mixer-panel-group .presets button:nth-of-type(23).active {
            background: rgba(255,0,130,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(24) {
            background: rgba(255,0,190,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(24):hover,
        .main-mixer-panel-group .presets button:nth-of-type(24).active {
            background: rgba(255,0,190,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(25) {
            background: rgba(255,0,250,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(25):hover,
        .main-mixer-panel-group .presets button:nth-of-type(25).active {
            background: rgba(255,0,250,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(26) {
            background: rgba(210,0,255,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(26):hover,
        .main-mixer-panel-group .presets button:nth-of-type(26).active {
            background: rgba(210,0,255,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(27) {
            background: rgba(150,0,255,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(27):hover,
        .main-mixer-panel-group .presets button:nth-of-type(27).active {
            background: rgba(150,0,255,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(28) {
            background: rgba(90,0,255,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(28):hover,
        .main-mixer-panel-group .presets button:nth-of-type(28).active {
            background: rgba(90,0,255,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(29) {
            background: rgba(30,0,255,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(29):hover,
        .main-mixer-panel-group .presets button:nth-of-type(29).active {
            background: rgba(30,0,255,1);
        }
        .main-mixer-panel-group .presets button:nth-of-type(30) {
            background: rgba(0,30,255,0.2);
        }
        .main-mixer-panel-group .presets button:nth-of-type(30):hover,
        .main-mixer-panel-group .presets button:nth-of-type(30).active {
            background: rgba(0,30,255,1);
        }

        .mirror-mode.clip {
            background: #23e648;
            color: black;
        }

        .mirror-mode.bleed {
            background: #e62323;
            color: white;
        }

        .mirror-mode.full {
            background: #23c2e6;
            color: black;
        }

        select {
            padding: 10px;
            width: 100%;
            background: black;
            color: #b2c2ad;
            border: solid 1px #1a2019;
            outline: none;
            border-radius: 2px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 11px;
            cursor: pointer;
        }

        input[type=range] {
            height: 39px;
            -webkit-appearance: none;
            margin: 10px 0;
            width: 100%;
            background: transparent;
        }

        input[type=range]:focus {
            outline: none;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            animate: 0.2s;
            box-shadow: 0px 0px 0px #000000;
            background: #000000;
            border-radius: 5px;
            border: 1px solid #202d2a;
        }

        input[type=range]::-webkit-slider-thumb {
            box-shadow: 0px 0px 0px #828282;
            border: 1px solid #474e46;
            height: 32px;
            width: 11px;
            border-radius: 3px;
            background: #ff8700;
            cursor: pointer;
            -webkit-appearance: none;
            margin-top: -13px;
        }

        input[type=range]:focus::-webkit-slider-runnable-track {
            background: #000000;
        }

        input[type=range]::-moz-range-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            animate: 0.2s;
            box-shadow: 0px 0px 0px #000000;
            background: #000000;
            border-radius: 5px;
            border: 1px solid #8A8A8A;
        }

        input[type=range]::-moz-range-thumb {
            box-shadow: 0px 0px 0px #828282;
            border: 1px solid #8A8A8A;
            height: 32px;
            width: 11px;
            border-radius: 3px;
            background: #DADADA;
            cursor: pointer;
        }

        input[type=range]::-ms-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            animate: 0.2s;
            background: transparent;
            border-color: transparent;
            color: transparent;
        }

        input[type=range]::-ms-fill-lower {
            background: #000000;
            border: 1px solid #8A8A8A;
            border-radius: 10px;
            box-shadow: 0px 0px 0px #000000;
        }

        input[type=range]::-ms-fill-upper {
            background: #000000;
            border: 1px solid #8A8A8A;
            border-radius: 10px;
            box-shadow: 0px 0px 0px #000000;
        }

        input[type=range]::-ms-thumb {
            margin-top: 1px;
            box-shadow: 0px 0px 0px #828282;
            border: 1px solid #8A8A8A;
            height: 32px;
            width: 11px;
            border-radius: 3px;
            background: #DADADA;
            cursor: pointer;
        }

        input[type=range]:focus::-ms-fill-lower {
            background: #000000;
        }

        input[type=range]:focus::-ms-fill-upper {
            background: #000000;
        }

        input[type=range]:disabled {
            opacity: 0.2;
        }

        .dropdowns {
            display: flex;
            gap: 10px;
        }

        .dropdowns group {
            width: 100%;
        }

        .dropdowns label {
            margin-bottom: 7px;
            display: block;
            opacity: 1;
            color: #8a9e8b;
            font-size: 9px;
            text-transform: uppercase;
            font-weight: 600;
            margin-left: 4px;
        }

        .deck-alpha {
            position: absolute;
            transform: rotate(-90deg);
        }

        #sliders-container {
            padding: 0 90px;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 25px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #000000;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 2px;
            border: 1px solid #202d2a;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 21px;
            width: 21px;
            left: 0px;
            bottom: 0px;
            background-color: #1c1c1c;
            -webkit-transition: .4s;
            transition: .4s;
            border: 1px solid #474e46;
            border-radius: 2px;
        }

        input:checked + .slider {
            background-color: #838e76;
            border: 1px solid #fff;
        }

        input:disabled + .slider {
            opacity: 0.2;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(25px);
            -ms-transform: translateX(25px);
            transform: translateX(25px);
        }

        .input-label {
            margin-bottom: 7px;
            display: block;
            opacity: 1;
            color: #8a9e8b;
            font-size: 9px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .input-label sub {
            display: block;
            margin-top: 4px;
            opacity: 0.4;
        }

        .inline-input {
            display: inline-block;
            vertical-align: top;
            padding: 5px 15px 10px 0;

            position: relative;
        }

        .flex-grid[data-columns="1"] > .inline-input,
        .flex-grid[data-columns="1"] > fieldset {
            flex: 0 0 100%;
        }

        .flex-grid[data-columns="2"] > .inline-input,
        .flex-grid[data-columns="2"] > fieldset {
            flex: 0 0 50%;
        }

        .flex-grid[data-columns="3"] > .inline-input,
        .flex-grid[data-columns="3"] > fieldset {
            flex: 0 0 33.333333%;
        }

        .flex-grid[data-columns="4"] > .inline-input,
        .flex-grid[data-columns="4"] > fieldset {
            flex: 0 0 25%;
        }

        .inline-field-group {
            display: inline;
            border-right: solid 1px #1f1e1e;
            width: 100%;
        }

        .inline-field-group:last-of-type {
            border-right: none;
        }

        .inline-field-group.inline-input {
            padding-top: 0;
        }

        .flex {
            display: flex;
            gap: 15px;
        }

        .flex:not(.no-wrap) {
            flex-wrap: wrap;
        }

        .flex .inline-input.w100 {
            width: 100%;
        }

        fieldset {
            border-top: solid 1px #1f1e1e;
            padding: 17px 0;
        }

        fieldset .heading,
        .main-mixer-panel-group .heading {
            margin-bottom: 7px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 14px;
            color: #313b30;
        }

        .visual-settings-tabs {
            margin-bottom: 20px;
        }

        .visual-settings-tabs ul {
            background: #0d0d0d;
            border: solid 1px #1a2019;
            display: flex;
            gap: 10px;
            padding: 10px;
        }

        .visual-settings-tabs button {
            margin: 0;
            width: initial;
        }

        .visual-settings-tabs button.on {
            background: #94c163;
        }

        .visual-settings,
        .main-mixer-panel {
            gap: 12px;
            display: flex;
            flex-direction: column;
            flex: 1 1 auto;
            overflow-y: auto;
        }

        .visual-settings span.value,
        .main-mixer-panel span.value {
            position: absolute;
            top: 5px;
            right: 16px;
            color: #dc892a;
            font-size: 9px;
            text-transform: uppercase;
            font-weight: 600;

            background: #0d0d0d;
            box-sizing: border-box;
            border: solid 1px #1a2019;
            padding: 4px 6px;
            line-height: 9px;
            width: 60px;
            text-align: right;
            top: -1px;
        }

        .kaleidoscope-slider-container,
        .mirror-mode-buttons-container {
            opacity: 1;
        }

        .kaleidoscope-slider-container.disabled,
        .mirror-mode-buttons-container.disabled {
            opacity: 0.4;
        }

        .mirror-mode-buttons-container.disabled .clip,
        .mirror-mode-buttons-container.disabled .full,
        .mirror-mode-buttons-container.disabled .bleed {
            opacity: 0.2;
        }

        .kaleidoscope-slider-container .inline-input {
            padding-right: 0;
            padding-bottom: 0;
        }

        .kaleidoscope-slider-container .inline-input span.value {
            right: 0;
        }

        .visual-settings input[type=range] {
            margin: 0;
        }

        .visual-settings .effects {
            padding-right: 15px;
        }

        .visual-settings .effects fieldset {
            border-top: none;
            padding-top: 0;
        }

        .visual-settings .effects .kaleidoscope-slider-container,
        .visual-settings .effects .mirror-mode-buttons-container {
            margin-top: 12px;
        }

        .visual-settings button {
            margin-top: 1px;
        }

        .visual-settings .button-radio-switch-group {
            margin-bottom: 15px;
            padding-right: 15px;
        }

        ::-webkit-scrollbar {
            width:2px
        }
        ::-webkit-scrollbar-track {
            background:#404040;
            border-radius:0px
        }
        ::-webkit-scrollbar-thumb {
            background:#cccccc;
            border-radius:0px
        }

        .hide {
            display: none;
        }

        .flex-grid {
            display: flex;
            flex-wrap: wrap;
        }

        .main-mixer-panel-group .flex-grid {
            gap: 10px;
            margin-top: 10px;
        }

        .flex-grid button {
            flex-basis: calc(33.33333333% - 6.6666666px);
            margin: 0;
        }

        .color-meter {
            background: black;
            display: block;
            width: 100%;
            height: 7px;
            border-radius: 2px;
            position: relative;
            top: 16px;
        }

        .color-meter.red {
            border: 1px solid #935353;
        }

        .color-meter.green {
            border: 1px solid #629353;
        }

        .color-meter.blue {
            border: 1px solid #535993;
        }

        .color-meter > div {
            display: block;
            width: 100%;
            height: 5px;
            border-radius: 2px;
            top: 0;
            position: absolute;
            left: 0;
            transform: scaleX(1);
            transform-origin: top left;
        }

        .color-meter.red > div {
            background: red;
        }

        .color-meter.green > div {
            background: green;
        }

        .color-meter.blue > div {
            background: blue;
        }

        #audio-meter-container {
            position: relative;
        }

        #audio-meter {
            height: 60px;
            margin-top: 10px;
            width: 100%;
            background: #0d0d0d;
            box-sizing: border-box;
            border: solid 1px #1a2019;
        }

        #audio-meter-chrome {
            position: absolute;
            left: 0;
            top: 30px;
            width: 100%;
            height: 20px;
            background: #0f1313;
            border-top: solid 1px #1a2019;
            border-bottom: solid 1px #1a2019;
        }

        #modal {
            position: fixed;
            background: black;
            border: solid 1px #ff5f00;
            padding: 15px;
            width: 1000px;
            height: 800px;
            top: calc(50% - 390px);
            left: calc(50% - 500px);
            font-size: 12px;
            color: #666;
        }

        #modal:not(.hide) {
            display: block;
        }

        #modal > div {
            position: relative;
        }

        #modal > div {
            display: block;
            font-size: 13px;
        }

        #modal .tabs {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
        }

        #modal .tab {
            border: solid 1px #222;
            color: #fff;
            border-radius: 0;
            width: auto;
            font-size: 9px;
            padding: 10px;
            border-bottom: none;
            position: relative;
            top: 1px;
            margin: 0 2px 0 0;
            background: #181818;
        }

        #modal .tab.active {
            background: #000;
        }

        #modal .settings > div,
        #modal .guide > div {
            padding: 20px;
            background: #000;
            border: solid 1px #212121;
        }

        #modal kbd {
            border: solid 1px #202020;
            background: #181818;
            padding: 4px 6px;
            display: inline-block;
            margin: 0 5px 10px 0;
            border-radius: 2px;
            color: #999;
            min-width: 22px;
            box-sizing: border-box;
            text-align: center;
        }

        #modal .ellipsis {
            margin-right: 5px;
        }

        #modal [data-target="default-midi-assignments"] .knob-explanations .knob-explanations-row,
        #modal [data-target="default-midi-assignments"] .key-explanations {
            display: flex;
            font-size: 10px;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        #modal [data-target="default-midi-assignments"] .knob-explanations .knob-explanations-row .knob-explanation,
        #modal [data-target="default-midi-assignments"] .key-explanations .key-explanation {
            padding: 0;
            list-style: none;
            width: 170px;
        }
        #modal [data-target="default-midi-assignments"] .key-explanations .key-explanation {
            color: #fff;
        }
        #modal [data-target="default-midi-assignments"] .knob-explanations .knob-explanations-row .knob-explanation[data-midi-keyboard-knob="1"] {
            color: #ff0000;
        }
        #modal [data-target="default-midi-assignments"] .knob-explanations .knob-explanations-row .knob-explanation[data-midi-keyboard-knob="2"] {
            color: #ffa500;
        }
        #modal [data-target="default-midi-assignments"] .knob-explanations .knob-explanations-row .knob-explanation[data-midi-keyboard-knob="3"] {
            color: #9aff00;
        }
        #modal [data-target="default-midi-assignments"] .knob-explanations .knob-explanations-row .knob-explanation[data-midi-keyboard-knob="4"] {
            color: #00d9ff;
        }
        #modal [data-target="default-midi-assignments"] .knob-explanations .knob-explanations-row .knob-explanation[data-midi-keyboard-knob="5"] {
            color: #001dff;
        }
        #modal [data-target="default-midi-assignments"] .knob-explanations .knob-explanations-row .knob-explanation[data-midi-keyboard-knob="6"] {
            color: #ab00ff;
        }
        #modal [data-target="default-midi-assignments"] .knob-explanations .knob-explanations-row .knob-explanation[data-midi-keyboard-knob="7"] {
            color: #ff0096;
        }
        #modal [data-target="default-midi-assignments"] .knob-explanations .knob-explanations-row .knob-explanation[data-midi-keyboard-knob="8"] {
            color: #ffffff;
        }
        #modal [data-target="default-midi-assignments"] .knob-explanations .knob-explanations-row .knob-explanation label,
        #modal [data-target="default-midi-assignments"] .key-explanations .key-explanation label {
            margin-right: 10px;
            color: #666;
        }
        #modal [data-target="default-midi-assignments"] .midi-keyboard {
            border: solid 2px #666;
            border-radius: 6px;
            width: 500px;
            display: flex;
            flex-direction: column;
            padding: 20px;
            margin: 25px 0;
        }
        #modal [data-target="default-midi-assignments"] .midi-keyboard ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        #modal [data-target="default-midi-assignments"] .midi-keyboard .midi-keyboard-knobs {
            padding: 0 0 15px;
        }
        #modal [data-target="default-midi-assignments"] .midi-keyboard .midi-keyboard-knobs li[data-midi-keyboard-knob] {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 10px;
            margin: 10px;
        }
        #modal [data-target="default-midi-assignments"] .midi-keyboard .midi-keyboard-knobs li[data-midi-keyboard-knob="1"] {
            background: #ff0000;
        }
        #modal [data-target="default-midi-assignments"] .midi-keyboard .midi-keyboard-knobs li[data-midi-keyboard-knob="2"] {
            background: #ffa500;
        }
        #modal [data-target="default-midi-assignments"] .midi-keyboard .midi-keyboard-knobs li[data-midi-keyboard-knob="3"] {
            background: #9aff00;
        }
        #modal [data-target="default-midi-assignments"] .midi-keyboard .midi-keyboard-knobs li[data-midi-keyboard-knob="4"] {
            background: #00d9ff;
        }
        #modal [data-target="default-midi-assignments"] .midi-keyboard .midi-keyboard-knobs li[data-midi-keyboard-knob="5"] {
            background: #001dff;
        }
        #modal [data-target="default-midi-assignments"] .midi-keyboard .midi-keyboard-knobs li[data-midi-keyboard-knob="6"] {
            background: #ab00ff;
        }
        #modal [data-target="default-midi-assignments"] .midi-keyboard .midi-keyboard-knobs li[data-midi-keyboard-knob="7"] {
            background: #ff0096;
        }
        #modal [data-target="default-midi-assignments"] .midi-keyboard .midi-keyboard-knobs li[data-midi-keyboard-knob="8"] {
            background: #ffffff;
        }
        #modal [data-target="default-midi-assignments"] .midi-keyboard .midi-keyboard-keys {
            display: flex;
        }
        #modal [data-target="default-midi-assignments"] .midi-keyboard .midi-keyboard-keys li {
            height: 140px;
            background: #fff;
            border: solid 2px black;
            display: inline-block;
            width: 30px;
        }
        #modal [data-target="default-midi-assignments"] .midi-keyboard .midi-keyboard-keys li.black-after:after {
            content: '';
            display: block;
            width: 20px;
            height: 75px;
            background: black;
            left: 21px;
            position: relative;
        }

        #modal fieldset {
            border: solid 1px #212121;
            padding: 10px 20px 20px;
            margin-top: 30px;
        }

        #modal fieldset label {
            display: block;
            color: #555;
        }

        #modal fieldset form {
            display: inline-block;
        }

        #modal fieldset button {
            background: #353535;
            color: #fff;
            border-radius: 4px;
            padding: 4px 8px;
            width: auto;
            font-weight: 500;
            font-size: 9px;
        }

        #modal-open {
            margin: 0 auto 30px;
            width: 60px;
            font-size: 20px;
        }

        #modal-close {
            display: inline-block;
            width: initial;
            position: absolute;
            top: 0;
            right: 0;
            margin: 0;
            border: solid 1px #3b3b3b;
            padding: 4px 8px;

            border: solid 1px #222;
            background: black;
            color: white;
            border-radius: 0;
            padding: 4px;
            width: auto;
            margin: 0 2px;
            outline: none;
            text-transform: uppercase;
            font-size: 9px;
            cursor: pointer;
        }

        .relative {
            position: relative;
        }

        .tooltip {
            position: absolute;
            width: 100%;
            bottom: 100%;
            background: #000000db;
            padding: 10px;
            border-radius: 3px;
            font-size: 9px;
            line-height: 14px;
            text-align: center;
            text-transform: uppercase;
            font-weight: 600;
            transition: all 300ms ease;
            opacity: 1;
        }

        .tooltip.success {
            color: #23e648;
        }

        .tooltip.error {
            color: #e62323;
        }

        .tooltip.transparent {
            opacity: 0;
        }

        .tooltip:after {
            content: '';
            position: absolute;
            left: calc(50% - 10px);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid #000000db;
            clear: both;
            bottom: -10px;
        }

        .push-top {
            margin-top: auto;
        }

        .text-align-center {
            text-align: center;
        }

        .grow {
            flex-grow: 1;
        }

        .inline-block {
            display: inline-block;
        }

        [data-tab-panel="randomisation"] .renderer,
        [data-tab-panel="randomisation"] .effects {
            border-bottom: solid 1px #1f1e1e;
        }

        [data-tab-panel="randomisation"] .effects fieldset {
            border-top: none;
            padding: 0;
            margin: 20px 0 16px;
        }

        [data-tab-panel="randomisation"] .effects fieldset:not(:first-of-type) {
            border-left: solid 1px #1f1e1e;
            padding: 0 0 0 17px;
        }

        #tap-bpm:active {
            background: #23e648;
            color: black;
        }

        #sync:active {
            background: #ffffff;
        }

        body.assigning #assign {
            -webkit-animation: borderBlink 1s step-end infinite;
            animation: borderBlink 1s step-end infinite;
        }

        body.assigning .inline-input:not([data-assignable]),
        body.assigning .inline-input:not([data-assignable]) input,
        body.assigning .inline-input:not([data-assignable]) button,
        body.assigning .inline-input:not([data-assignable]) .slider {
            opacity: 0.2;
            cursor: not-allowed;
        }

        body.assigning .inline-input:not([data-assignable]) input[type=range]::-webkit-slider-runnable-track,
        body.assigning .inline-input:not([data-assignable]) input[type=range]::-webkit-slider-thumb {
            opacity: 0.2;
            cursor: not-allowed;
        }
        body.assigning .inline-input:not([data-assignable]) input[type=range]::-moz-range-track,
        body.assigning .inline-input:not([data-assignable]) input[type=range]::-moz-range-thumb {
            opacity: 0.2;
            cursor: not-allowed;
        }
        body.assigning .inline-input:not([data-assignable]) input[type=range]::-ms-track,
        body.assigning .inline-input:not([data-assignable]) input[type=range]::-ms-thumb {
            opacity: 0.2;
            cursor: not-allowed;
        }

        body.assigning [data-assignable],
        body.assigning [data-assignable] input,
        body.assigning [data-assignable] button,
        body.assigning [data-assignable] .slider {
            cursor: crosshair;
        }

        body.assigning [data-assignable] input[type=range]::-webkit-slider-runnable-track,
        body.assigning [data-assignable] input[type=range]::-webkit-slider-thumb {
            cursor: crosshair;
        }
        body.assigning [data-assignable] input[type=range]::-moz-range-track,
        body.assigning [data-assignable] input[type=range]::-moz-range-thumb {
            cursor: crosshair;
        }
        body.assigning [data-assignable] input[type=range]::-ms-track,
        body.assigning [data-assignable] input[type=range]::-ms-thumb  {
            cursor: crosshair;
        }

        body.assigning.selected [data-assignable],
        body.assigning.selected [data-assignable] input,
        body.assigning.selected [data-assignable] button,
        body.assigning.selected [data-assignable] .slider {
            cursor: wait;
        }

        body.assigning.selected [data-assignable] input[type=range]::-webkit-slider-runnable-track,
        body.assigning.selected [data-assignable] input[type=range]::-webkit-slider-thumb {
            cursor: wait;
        }
        body.assigning.selected [data-assignable] input[type=range]::-moz-range-track,
        body.assigning.selected [data-assignable] input[type=range]::-moz-range-thumb {
            cursor: wait;
        }
        body.assigning.selected [data-assignable] input[type=range]::-ms-track,
        body.assigning.selected [data-assignable] input[type=range]::-ms-thumb  {
            cursor: wait;
        }

        @-webkit-keyframes borderBlink {
            from, to {
                border-color: #222;
                color: #ffffff;
            }
            50% {
                border-color: #ffa500;
                color: #ffa500;
            }
        }
        @keyframes borderBlink {
            from, to {
                border-color: #222;
                color: #ffffff;
            }
            50% {
                border-color: #ffa500;
                color: #ffa500;
            }
        }

        @-webkit-keyframes backgroundBlink {
            from, to {
                background: #000;
            }
            50% {
                background: rgba(0, 205, 255, 0.4);
            }
        }
        @keyframes backgroundBlink {
            from, to {
                background: #000;
            }
            50% {
                background: rgba(0, 205, 255, 0.4);
            }
        }
    </style>

    <style>
        .high-contrast {
            background: #000;
        }

        .high-contrast .column {
            background: #fff;
        }

        .high-contrast #audio-meter {
            background: #fff;
        }

        .high-contrast #audio-meter-chrome {
            background: #fff;
        }

        .high-contrast .visual-settings-tabs ul {
            background: #fff;
        }

        .high-contrast .mirror-mode-buttons-container.disabled .clip,
        .high-contrast .mirror-mode-buttons-container.disabled .full,
        .high-contrast .mirror-mode-buttons-container.disabled .bleed {
            opacity: initial;
        }

        .high-contrast button {
            color: #000;
        }

        .high-contrast button:hover {
            background: #000;
            color: #fff;
        }
    </style>
</head>

<body>
    <div id="hydra">
        <section id="deck-screens" class="section">
            <div class="column">
                <div class="deck-screen">
                    <canvas id="deck-1-canvas" class="canvas hide"></canvas>
                    <canvas id="deck-1-pipe-canvas" class="canvas"></canvas>
                </div>
            </div>
            <div class="column">
                <div class="deck-screen">
                    <canvas id="mixed-canvas" class="canvas"></canvas>
                </div>
            </div>
            <div class="column">
                <div class="deck-screen">
                    <canvas id="deck-2-canvas" class="canvas hide"></canvas>
                    <canvas id="deck-2-pipe-canvas" class="canvas"></canvas>
                </div>
            </div>
        </section>
        <section class="section">
            <div class="column">
                <div class="lcd-screen">
                    <span class="readout">Deck 1</span>
                    <span class="readout"><span class="label">Alpha:</span> <span class="value" data-deck-1-alpha-display></span></span></span>
                </div>
            </div>
            <div class="column">
                <div class="lcd-screen">
                    <span class="readout">Output</span>
                    <span class="readout"><span class="label">Crossfader:</span> <span id="crossfader-display">D1 1.0000 D2 1.0000</span></span>
                    <span class="readout"><span class="label">BPM:</span> <span class="value" data-bpm-display>TAP&nbsp;&nbsp;&nbsp;</span></span>
                </div>
            </div>
            <div class="column">
                <div class="lcd-screen">
                    <span class="readout">Deck 2</span>
                    <span class="readout"><span class="label">Alpha:</span> <span class="value" data-deck-2-alpha-display></span></span>
                </div>
            </div>
        </section>
        <section id="dropdowns" class="section">
            <div class="column dropdowns">
                <group>
                    <label>Visual</label>
                    <select class="visual-selector" data-deck="1"></select>
                </group>
                <button class="reset" data-deck="1">⭮</button>
            </div>
            <div class="column dropdowns">
                <button class="raise-to-top" data-deck="1">↥</button>
                <group>
                    <label>Mode</label>
                    <select id="composition-mode-selector">
                        <option value="color-burn">color-burn</option>
                        <option value="color-dodge">color-dodge</option>
                        <option value="color">color</option>
                        <option value="copy">copy</option>
                        <option value="darken">darken</option>
                        <option value="destination-atop">destination-atop</option>
                        <option value="destination-in">destination-in</option>
                        <option value="destination-out">destination-out</option>
                        <option value="destination-over">destination-over</option>
                        <option value="difference">difference</option>
                        <option value="exclusion">exclusion</option>
                        <option value="hard-light">hard-light</option>
                        <option value="hue">hue</option>
                        <option value="lighten">lighten</option>
                        <option value="lighter">lighter</option>
                        <option value="luminosity">luminosity</option>
                        <option value="multiply">multiply</option>
                        <option value="overlay" selected>overlay</option>
                        <option value="saturation">saturation</option>
                        <option value="screen">screen</option>
                        <option value="soft-light">soft-light</option>
                        <option value="source-atop">source-atop</option>
                        <option value="source-in">source-in</option>
                        <option value="source-out">source-out</option>
                        <option value="source-over">source-over</option>
                        <option value="xor">xor</option>
                    </select>
                </group>
                <button class="raise-to-top raised" data-deck="2">↥</button>
            </div>
            <div class="column dropdowns">
                <group>
                    <label>Visual</label>
                    <select class="visual-selector" data-deck="2"></select>
                </group>
                <button class="reset" data-deck="2">&#x2B6E;</button>
            </div>
        </section>
        <section class="section extend scroll-overflow-y">
            <div class="column">
                <ul class="visual-settings-tabs">
                    <ul>
                        <li><button class="on" data-deck="1" data-tab="renderer">Renderer</button></li>
                        <li><button data-deck="1" data-tab="effects">Effects</button></li>
                        <li><button data-deck="1" data-tab="reactivity">Reactivity</button></li>
                        <li><button data-deck="1" data-tab="randomisation">Randomisation</button></li>
                    </ul>
                </ul>
                <div class="visual-settings" data-deck="1">
                    <div data-tab-panel="effects" class="effects hide">
                        <fieldset>
                            <div class="heading">Reflection</div>
                            <div class="button-group">
                                <div><button id="kaleidoscope-deck1-toggle" class="kaleidoscope-toggle" data-target="deck1">Kaleidoscope</button></div>
                                <div><button id="mirror-deck1-toggle" class="mirror-toggle" data-target="deck1">Mirror</button></div>
                            </div>
                            <div class="button-group kaleidoscope-slider-container disabled">
                                <div class="inline-input">
                                    <span class="input-label">Kaleidoscope Angle</span>
                                    <span class="value">68</span>
                                    <input id="kaleidoscope-deck1-angle" class="kaleidoscope-angle" type="range" min="25" max="180" value="68" step="0.001" data-target="deck1">
                                </div>
                            </div>
                            <div class="mirror-mode-buttons-container disabled">
                                <span class="input-label">Mirror Type</span>
                                <div class="button-group button-radio-switch-group">
                                    <div><button class="mirror-mode applies-clip clip button-radio-switch" data-target="deck1">clip</button></div>
                                    <div><button class="mirror-mode applies-full button-radio-switch" data-target="deck1">full</button></div>
                                    <div><button class="mirror-mode applies-bleed button-radio-switch" data-target="deck1">bleed</button></div>
                                </div>
                            </div>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Blur</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="1" data-blur-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">0</span>
                                    <input type="range" min="0" max="100" value="0" step="1" data-deck="1" data-blur-value>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Brightness</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="1" data-brightness-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">1</span>
                                    <input type="range" min="0" max="1" value="1" step="0.001" data-deck="1" data-brightness-value>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Contrast</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="1" data-contrast-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">1</span>
                                    <input type="range" min="0" max="1" value="1" step="0.001" data-deck="1" data-contrast-value>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Drop-Shadow</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="1" data-drop-shadow-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input">
                                    <span class="input-label">Color</span>
                                    <input type="color" value="#ff0000" data-deck="1" data-drop-shadow-color>
                                </div>
                                <div class="flex-grid grow" data-columns="3">
                                    <div class="inline-input">
                                        <span class="input-label">Offset X</span>
                                        <span class="value">0</span>
                                        <input type="range" min="-100" max="100" value="0" step="0.001" data-deck="1" data-drop-shadow-offset-x>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Offset Y</span>
                                        <span class="value">0</span>
                                        <input type="range" min="-100" max="100" value="0" step="0.001" data-deck="1" data-drop-shadow-offset-y>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Blur</span>
                                        <span class="value">0</span>
                                        <input type="range" min="0" max="100" value="0" step="0.001" data-deck="1" data-drop-shadow-blur>
                                    </div>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Grayscale</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="1" data-grayscale-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">0</span>
                                    <input type="range" min="0" max="1" value="0" step="0.001" data-deck="1" data-grayscale-value>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Hue-Rotate</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="1" data-hue-rotate-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">0</span>
                                    <input type="range" min="0" max="360" value="0" step="0.001" data-deck="1" data-hue-rotate-value>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Invert</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="1" data-invert-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">0</span>
                                    <input type="range" min="0" max="1" value="0" step="0.001" data-deck="1" data-invert-value>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Opacity</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="1" data-opacity-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">1</span>
                                    <input type="range" min="0" max="1" value="1" step="0.001" data-deck="1" data-opacity-value>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Saturate</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="1" data-saturate-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">1</span>
                                    <input type="range" min="0" max="1" value="1" step="0.001" data-deck="1" data-saturate-value>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Sepia</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="1" data-sepia-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">0</span>
                                    <input type="range" min="0" max="1" value="0" step="0.001" data-deck="1" data-sepia-value>
                                </div>
                            </group>
                        </fieldset>
                    </div>
                    <div data-tab-panel="reactivity" class="reactivity hide">
                        <div class="flex-grid" data-columns="2">
                            <fieldset>
                                <div class="heading">Scale</div>
                                <group class="flex">
                                    <div class="inline-input">
                                        <span class="input-label">React</span>
                                        <label class="switch">
                                            <input type="checkbox" checked data-deck="1" data-scale-enabled data-randomiseable>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input grow">
                                        <span class="input-label">Strength</span>
                                        <span class="value">100</span>
                                        <input type="range" min="0" max="100" value="100" step="1" data-deck="1" data-scale-strength data-randomiseable>
                                    </div>
                                </group>
                                <group>
                                    <span class="input-label">Cause</span>
                                    <div class="button-group button-radio-switch-group">
                                        <div><button class="on button-radio-switch" data-deck="1" data-scale-cause="average" data-randomiseable>Average</button></div>
                                        <div><button class="button-radio-switch" data-deck="1" data-scale-cause="percentage" data-randomiseable>Percentage</button></div>
                                    </div>
                                </group>
                                <group>
                                    <span class="input-label">Effect</span>
                                    <div class="button-group button-radio-switch-group">
                                        <div><button class="on button-radio-switch" data-deck="1" data-scale-effect="add" data-randomiseable>Add</button></div>
                                        <div><button class="button-radio-switch" data-deck="1" data-scale-effect="subtract" data-randomiseable>Subtract</button></div>
                                        <div><button class="button-radio-switch" data-deck="1" data-scale-effect="multiply" data-randomiseable>Multiply</button></div>
                                    </div>
                                </group>
                            </fieldset>
                            <fieldset>
                                <div class="heading">Color</div>
                                <group class="flex">
                                    <div class="inline-input">
                                        <span class="input-label">React</span>
                                        <label class="switch">
                                            <input type="checkbox" checked data-deck="1" data-color-enabled data-randomiseable>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input grow">
                                        <span class="input-label">Strength</span>
                                        <span class="value">100</span>
                                        <input type="range" min="0" max="100" value="100" step="1" data-deck="1" data-color-strength data-randomiseable>
                                    </div>
                                </group>
                                <group>
                                    <span class="input-label">Cause</span>
                                    <div class="button-group button-radio-switch-group">
                                        <div><button class="on button-radio-switch" data-deck="1" data-color-cause="average" data-randomiseable>Average</button></div>
                                        <div><button class="button-radio-switch" data-deck="1" data-color-cause="percentage" data-randomiseable>Percentage</button></div>
                                    </div>
                                </group>
                                <group>
                                    <span class="input-label">Effect</span>
                                    <div class="button-group button-radio-switch-group">
                                        <div><button class="on button-radio-switch" data-deck="1" data-color-effect="add" data-randomiseable>Add</button></div>
                                        <div><button class="button-radio-switch" data-deck="1" data-color-effect="subtract" data-randomiseable>Subtract</button></div>
                                        <div><button class="button-radio-switch" data-deck="1" data-color-effect="multiply" data-randomiseable>Multiply</button></div>
                                    </div>
                                </group>
                            </fieldset>
                        </div>
                        <div class="flex-grid" data-columns="2">
                            <fieldset>
                                <div class="heading">Alpha</div>
                                <group class="flex">
                                    <div class="inline-input">
                                        <span class="input-label">React</span>
                                        <label class="switch">
                                            <input type="checkbox" checked data-deck="1" data-alpha-enabled data-randomiseable>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input grow">
                                        <span class="input-label">Strength</span>
                                        <span class="value">100</span>
                                        <input type="range" min="0" max="100" value="100" step="1" data-deck="1" data-alpha-strength data-randomiseable>
                                    </div>
                                </group>
                                <group>
                                    <span class="input-label">Cause</span>
                                    <div class="button-group button-radio-switch-group">
                                        <div><button class="on button-radio-switch" data-deck="1" data-alpha-cause="average" data-randomiseable>Average</button></div>
                                        <div><button class="button-radio-switch" data-deck="1" data-alpha-cause="percentage" data-randomiseable>Percentage</button></div>
                                    </div>
                                </group>
                                <group>
                                    <span class="input-label">Effect</span>
                                    <div class="button-group button-radio-switch-group">
                                        <div><button class="on button-radio-switch" data-deck="1" data-alpha-effect="add" data-randomiseable>Add</button></div>
                                        <div><button class="button-radio-switch" data-deck="1" data-alpha-effect="subtract" data-randomiseable>Subtract</button></div>
                                        <div><button class="button-radio-switch" data-deck="1" data-alpha-effect="multiply" data-randomiseable>Multiply</button></div>
                                    </div>
                                </group>
                            </fieldset>
                            <fieldset>
                                <div class="heading">Amp</div>
                                <group class="flex">
                                    <div class="inline-input">
                                        <span class="input-label">React</span>
                                        <label class="switch">
                                            <input type="checkbox" checked data-deck="1" data-amp-enabled data-randomiseable>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input grow">
                                        <span class="input-label">Strength</span>
                                        <span class="value">100</span>
                                        <input type="range" min="0" max="100" value="100" step="1" data-deck="1" data-amp-strength data-randomiseable>
                                    </div>
                                </group>
                                <group>
                                    <span class="input-label">Cause</span>
                                    <div class="button-group button-radio-switch-group">
                                        <div><button class="on button-radio-switch" data-deck="1" data-amp-cause="average" data-randomiseable>Average</button></div>
                                        <div><button class="button-radio-switch" data-deck="1" data-amp-cause="percentage" data-randomiseable>Percentage</button></div>
                                    </div>
                                </group>
                                <group>
                                    <span class="input-label">Effect</span>
                                    <div class="button-group button-radio-switch-group">
                                        <div><button class="on button-radio-switch" data-deck="1" data-amp-effect="add" data-randomiseable>Add</button></div>
                                        <div><button class="button-radio-switch" data-deck="1" data-amp-effect="subtract" data-randomiseable>Subtract</button></div>
                                        <div><button class="button-radio-switch" data-deck="1" data-amp-effect="multiply" data-randomiseable>Multiply</button></div>
                                    </div>
                                </group>
                            </fieldset>
                        </div>
                    </div>
                    <div data-tab-panel="randomisation" class="randomisation hide">
                        <div class="effects flex">
                            <fieldset>
                                <div class="heading">Blur</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-blur-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-blur-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                            <fieldset>
                                <div class="heading">Brightness</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-brightness-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-brightness-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                            <fieldset>
                                <div class="heading">Contrast</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-contrast-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-contrast-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                        </div>
                        <div class="effects flex">
                            <fieldset>
                                <div class="heading">Drop-Shadow</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-drop-shadow-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Color</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-drop-shadow-color" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Offset X</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-drop-shadow-offset-x" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Offset Y</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-drop-shadow-offset-y" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Blur</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-drop-shadow-blur" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                        </div>
                        <div class="effects flex">
                            <fieldset>
                                <div class="heading">Grayscale</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-grayscale-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-grayscale-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                            <fieldset>
                                <div class="heading">Hue-Rotate</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-hue-rotate-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-hue-rotate-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                            <fieldset>
                                <div class="heading">Invert</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-invert-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-invert-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                        </div>
                        <div class="effects flex">
                            <fieldset>
                                <div class="heading">Opacity</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-opacity-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-opacity-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                            <fieldset>
                                <div class="heading">Saturate</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-saturate-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-saturate-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                            <fieldset>
                                <div class="heading">Sepia</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-sepia-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="1" data-target="data-sepia-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                        </div>
                    </div>
                </div>
                <div class="button-group">
                    <div class="relative">
                        <div class="tooltip hide"></div>
                        <button class="pink" data-deck="1" data-send>Send</button>
                    </div>
                    <div class="relative">
                        <div class="tooltip hide"></div>
                        <button class="blue" data-deck="1" data-receive>Receive</button>
                    </div>
                    <div><button class="yellow" data-deck="1" data-save>Save</button></div>
                    <div><button class="green" class="green" data-deck="1" data-randomise>Randomise</button></div>
                </div>
                <div class="button-group">
                    <div><button data-deck="1" data-react>React</button></div>
                    <div><button data-deck="1" data-keyboard>Keyboard</button></div>
                    <div><button data-deck="1" data-guide>Guide</button></div>
                    <div><button class="red" data-deck="1" data-revert>Revert</button></div>
                </div>
            </div>
            <div class="column main-mixer-panel-container">
                <div id="sliders-container">
                    <div id="sliders">
                        <input type="range" min="0" max="1" value="1" step="0.0001" class="deck-alpha" data-deck="1" data-variable="alpha" data-precision="4">
                        <input type="range" min="0" max="1" value="1" step="0.0001" class="deck-alpha" data-deck="2" data-variable="alpha" data-precision="4">
                    </div>
                    <div class="main-mixer-panel">
                        <div id="audio-meter-container">
                            <canvas id="audio-meter"></canvas>
                            <div id="audio-meter-chrome"></div>
                        </div>
                        <div class="button-group">
                            <div><button id="kaleidoscope-output-toggle" class="kaleidoscope-toggle" data-target="output">Kaleidoscope</button></div>
                            <div><button id="mirror-output-toggle" class="mirror-toggle" data-target="output">Mirror</button></div>
                        </div>
                        <div class="button-group kaleidoscope-slider-container disabled">
                            <div class="inline-input">
                                <span class="input-label">Kaleidoscope Angle</span>
                                <span class="value">68</span>
                                <input id="kaleidoscope-output-angle" class="kaleidoscope-angle" type="range" min="25" max="180" value="68" step="0.001" data-target="output">
                            </div>
                        </div>
                        <div class="mirror-mode-buttons-container disabled">
                            <span class="input-label">Mirror Type</span>
                            <div class="button-group button-radio-switch-group">
                                <div><button class="mirror-mode applies-clip clip button-radio-switch" data-target="output">clip</button></div>
                                <div><button class="mirror-mode applies-full button-radio-switch" data-target="output">full</button></div>
                                <div><button class="mirror-mode applies-bleed button-radio-switch" data-target="output">bleed</button></div>
                            </div>
                        </div>
                        <div class="button-group hide">
                            <button class="auto" data-deck="1">Auto</button>
                            <button class="auto" data-deck="2">Auto</button>
                        </div>
                        <div class="extend">
                            <div class="main-mixer-panel-group">
                                <div class="deck-1">
                                    <label class="heading">Presets</label>
                                    <button data-deck="1" data-import-presets>Import</button>
                                    <button data-deck="1" data-export-presets>Export</button>
                                    <div class="flex-grid presets" data-deck="1">
                                        <button class="preset" data-deck="1" data-preset="1" disabled>1</button>
                                        <button class="preset" data-deck="1" data-preset="2" disabled>2</button>
                                        <button class="preset" data-deck="1" data-preset="3" disabled>3</button>
                                        <button class="preset" data-deck="1" data-preset="4" disabled>4</button>
                                        <button class="preset" data-deck="1" data-preset="5" disabled>5</button>
                                        <button class="preset" data-deck="1" data-preset="6" disabled>6</button>
                                        <button class="preset" data-deck="1" data-preset="7" disabled>7</button>
                                        <button class="preset" data-deck="1" data-preset="8" disabled>8</button>
                                        <button class="preset" data-deck="1" data-preset="9" disabled>9</button>
                                        <button class="preset" data-deck="1" data-preset="10" disabled>10</button>
                                        <button class="preset" data-deck="1" data-preset="11" disabled>11</button>
                                        <button class="preset" data-deck="1" data-preset="12" disabled>12</button>
                                        <button class="preset" data-deck="1" data-preset="13" disabled>13</button>
                                        <button class="preset" data-deck="1" data-preset="14" disabled>14</button>
                                        <button class="preset" data-deck="1" data-preset="15" disabled>15</button>
                                        <button class="preset" data-deck="1" data-preset="16" disabled>16</button>
                                        <button class="preset" data-deck="1" data-preset="17" disabled>17</button>
                                        <button class="preset" data-deck="1" data-preset="18" disabled>18</button>
                                        <button class="preset" data-deck="1" data-preset="19" disabled>19</button>
                                        <button class="preset" data-deck="1" data-preset="20" disabled>20</button>
                                        <button class="preset" data-deck="1" data-preset="21" disabled>21</button>
                                        <button class="preset" data-deck="1" data-preset="22" disabled>22</button>
                                        <button class="preset" data-deck="1" data-preset="23" disabled>23</button>
                                        <button class="preset" data-deck="1" data-preset="24" disabled>24</button>
                                        <button class="preset" data-deck="1" data-preset="25" disabled>25</button>
                                        <button class="preset" data-deck="1" data-preset="26" disabled>26</button>
                                        <button class="preset" data-deck="1" data-preset="27" disabled>27</button>
                                        <button class="preset" data-deck="1" data-preset="28" disabled>28</button>
                                        <button class="preset" data-deck="1" data-preset="29" disabled>29</button>
                                        <button class="preset" data-deck="1" data-preset="30" disabled>30</button>
                                    </div>
                                    <div class="button-group">
                                        <div><button data-deck="1" data-previous-preset>◄</button></div>
                                        <div><button data-deck="1" data-next-preset>►</button></div>
                                    </div>
                                </div>
                                <div class="push-top text-align-center">
                                    <button id="modal-open">⚙</button>
                                    <button id="launch">Launch</button>
                                </div>
                                <div class="deck-2">
                                    <label class="heading">Presets</label>
                                    <button data-deck="2" data-import-presets>Import</button>
                                    <button data-deck="2" data-export-presets>Export</button>
                                    <div class="flex-grid presets" data-deck="2">
                                        <button class="preset" data-deck="2" data-preset="1" disabled>1</button>
                                        <button class="preset" data-deck="2" data-preset="2" disabled>2</button>
                                        <button class="preset" data-deck="2" data-preset="3" disabled>3</button>
                                        <button class="preset" data-deck="2" data-preset="4" disabled>4</button>
                                        <button class="preset" data-deck="2" data-preset="5" disabled>5</button>
                                        <button class="preset" data-deck="2" data-preset="6" disabled>6</button>
                                        <button class="preset" data-deck="2" data-preset="7" disabled>7</button>
                                        <button class="preset" data-deck="2" data-preset="8" disabled>8</button>
                                        <button class="preset" data-deck="2" data-preset="9" disabled>9</button>
                                        <button class="preset" data-deck="2" data-preset="10" disabled>10</button>
                                        <button class="preset" data-deck="2" data-preset="11" disabled>11</button>
                                        <button class="preset" data-deck="2" data-preset="12" disabled>12</button>
                                        <button class="preset" data-deck="2" data-preset="13" disabled>13</button>
                                        <button class="preset" data-deck="2" data-preset="14" disabled>14</button>
                                        <button class="preset" data-deck="2" data-preset="15" disabled>15</button>
                                        <button class="preset" data-deck="2" data-preset="16" disabled>16</button>
                                        <button class="preset" data-deck="2" data-preset="17" disabled>17</button>
                                        <button class="preset" data-deck="2" data-preset="18" disabled>18</button>
                                        <button class="preset" data-deck="2" data-preset="19" disabled>19</button>
                                        <button class="preset" data-deck="2" data-preset="20" disabled>20</button>
                                        <button class="preset" data-deck="2" data-preset="21" disabled>21</button>
                                        <button class="preset" data-deck="2" data-preset="22" disabled>22</button>
                                        <button class="preset" data-deck="2" data-preset="23" disabled>23</button>
                                        <button class="preset" data-deck="2" data-preset="24" disabled>24</button>
                                        <button class="preset" data-deck="2" data-preset="25" disabled>25</button>
                                        <button class="preset" data-deck="2" data-preset="26" disabled>26</button>
                                        <button class="preset" data-deck="2" data-preset="27" disabled>27</button>
                                        <button class="preset" data-deck="2" data-preset="28" disabled>28</button>
                                        <button class="preset" data-deck="2" data-preset="29" disabled>29</button>
                                        <button class="preset" data-deck="2" data-preset="30" disabled>30</button>
                                    </div>
                                    <div class="button-group">
                                        <div><button data-deck="2" data-previous-preset>◄</button></div>
                                        <div><button data-deck="2" data-next-preset>►</button></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="crossfader-section">
                            <div id="crossfader-container">
                                <input id="crossfader" type="range" min="-1" max="1" value="0" step="0.0001">
                            </div>
                        </div>
                    </div>
                    <div class="button-group">
                        <div><button id="record" class="red">Record</button></div>
                    </div>
                    <div class="button-group">
                        <div><button id="tap-bpm">Tap</button></div>
                        <div><button id="sync" class="on">Sync</button></div>
                        <div><button id="assign">Assign</button></div>
                    </div>
                </div>
            </div>
            <div class="column">
                <ul class="visual-settings-tabs">
                    <ul>
                        <li><button class="on" data-deck="2" data-tab="renderer">Renderer</button></li>
                        <li><button data-deck="2" data-tab="effects">Effects</button></li>
                        <li><button data-deck="2" data-tab="reactivity">Reactivity</button></li>
                        <li><button data-deck="2" data-tab="randomisation">Randomisation</button></li>
                    </ul>
                </ul>
                <div class="visual-settings" data-deck="2">
                    <div data-tab-panel="effects" class="effects hide">
                        <fieldset>
                            <div class="heading">Reflection</div>
                            <div class="button-group">
                                <div><button id="kaleidoscope-deck2-toggle" class="kaleidoscope-toggle" data-target="deck2">Kaleidoscope</button></div>
                                <div><button id="mirror-deck2-toggle" class="mirror-toggle" data-target="deck2">Mirror</button></div>
                            </div>
                            <div class="button-group kaleidoscope-slider-container disabled">
                                <div class="inline-input">
                                    <span class="input-label">Kaleidoscope Angle</span>
                                    <span class="value">68</span>
                                    <input id="kaleidoscope-deck2-angle" class="kaleidoscope-angle" type="range" min="25" max="180" value="68" step="0.001" data-target="deck2">
                                </div>
                            </div>
                            <div class="mirror-mode-buttons-container disabled">
                                <span class="input-label">Mirror Type</span>
                                <div class="button-group button-radio-switch-group">
                                    <div><button class="mirror-mode applies-clip clip button-radio-switch" data-target="deck2">clip</button></div>
                                    <div><button class="mirror-mode applies-full button-radio-switch" data-target="deck2">full</button></div>
                                    <div><button class="mirror-mode applies-bleed button-radio-switch" data-target="deck2">bleed</button></div>
                                </div>
                            </div>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Blur</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="2" data-blur-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">0</span>
                                    <input type="range" min="0" max="100" value="0" step="1" data-deck="2" data-blur-value>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Brightness</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="2" data-brightness-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">1</span>
                                    <input type="range" min="0" max="1" value="1" step="0.001" data-deck="2" data-brightness-value>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Contrast</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="2" data-contrast-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">1</span>
                                    <input type="range" min="0" max="1" value="1" step="0.001" data-deck="2" data-contrast-value>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Drop-Shadow</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="2" data-drop-shadow-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input">
                                    <span class="input-label">Color</span>
                                    <input type="color" value="#ff0000" data-deck="2" data-drop-shadow-color>
                                </div>
                                <div class="flex-grid grow" data-columns="3">
                                    <div class="inline-input">
                                        <span class="input-label">Offset X</span>
                                        <span class="value">0</span>
                                        <input type="range" min="-100" max="100" value="0" step="0.001" data-deck="2" data-drop-shadow-offset-x>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Offset Y</span>
                                        <span class="value">0</span>
                                        <input type="range" min="-100" max="100" value="0" step="0.001" data-deck="2" data-drop-shadow-offset-y>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Blur</span>
                                        <span class="value">0</span>
                                        <input type="range" min="0" max="100" value="0" step="0.001" data-deck="2" data-drop-shadow-blur>
                                    </div>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Grayscale</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="2" data-grayscale-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">0</span>
                                    <input type="range" min="0" max="1" value="0" step="0.001" data-deck="2" data-grayscale-value>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Hue-Rotate</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="2" data-hue-rotate-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">0</span>
                                    <input type="range" min="0" max="360" value="0" step="0.001" data-deck="2" data-hue-rotate-value>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Invert</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="2" data-invert-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">0</span>
                                    <input type="range" min="0" max="1" value="0" step="0.001" data-deck="2" data-invert-value>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Opacity</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="2" data-opacity-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">1</span>
                                    <input type="range" min="0" max="1" value="1" step="0.001" data-deck="2" data-opacity-value>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Saturate</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="2" data-saturate-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">1</span>
                                    <input type="range" min="0" max="1" value="1" step="0.001" data-deck="2" data-saturate-value>
                                </div>
                            </group>
                        </fieldset>
                        <fieldset>
                            <div class="heading">Sepia</div>
                            <group class="flex">
                                <div class="inline-input">
                                    <span class="input-label">Enable</span>
                                    <label class="switch">
                                        <input type="checkbox" data-deck="2" data-sepia-toggle>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="inline-input grow">
                                    <span class="input-label">Value</span>
                                    <span class="value">0</span>
                                    <input type="range" min="0" max="1" value="0" step="0.001" data-deck="2" data-sepia-value>
                                </div>
                            </group>
                        </fieldset>
                    </div>
                    <div data-tab-panel="reactivity" class="reactivity hide">
                        <div class="flex-grid" data-columns="2">
                            <fieldset>
                                <div class="heading">Scale</div>
                                <group class="flex">
                                    <div class="inline-input">
                                        <span class="input-label">React</span>
                                        <label class="switch">
                                            <input type="checkbox" checked data-deck="2" data-scale-enabled data-randomiseable>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input grow">
                                        <span class="input-label">Strength</span>
                                        <span class="value">100</span>
                                        <input type="range" min="0" max="100" value="100" step="1" data-deck="2" data-scale-strength data-randomiseable>
                                    </div>
                                </group>
                                <group>
                                    <span class="input-label">Cause</span>
                                    <div class="button-group button-radio-switch-group">
                                        <div><button class="on button-radio-switch" data-deck="2" data-scale-cause="average" data-randomiseable>Average</button></div>
                                        <div><button class="button-radio-switch" data-deck="2" data-scale-cause="percentage" data-randomiseable>Percentage</button></div>
                                    </div>
                                </group>
                                <group>
                                    <span class="input-label">Effect</span>
                                    <div class="button-group button-radio-switch-group">
                                        <div><button class="on button-radio-switch" data-deck="2" data-scale-effect="add" data-randomiseable>Add</button></div>
                                        <div><button class="button-radio-switch" data-deck="2" data-scale-effect="subtract" data-randomiseable>Subtract</button></div>
                                        <div><button class="button-radio-switch" data-deck="2" data-scale-effect="multiply" data-randomiseable>Multiply</button></div>
                                    </div>
                                </group>
                            </fieldset>
                            <fieldset>
                                <div class="heading">Color</div>
                                <group class="flex">
                                    <div class="inline-input">
                                        <span class="input-label">React</span>
                                        <label class="switch">
                                            <input type="checkbox" checked data-deck="2" data-color-enabled data-randomiseable>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input grow">
                                        <span class="input-label">Strength</span>
                                        <span class="value">100</span>
                                        <input type="range" min="0" max="100" value="100" step="1" data-deck="2" data-color-strength data-randomiseable>
                                    </div>
                                </group>
                                <group>
                                    <span class="input-label">Cause</span>
                                    <div class="button-group button-radio-switch-group">
                                        <div><button class="on button-radio-switch" data-deck="2" data-color-cause="average" data-randomiseable>Average</button></div>
                                        <div><button class="button-radio-switch" data-deck="2" data-color-cause="percentage" data-randomiseable>Percentage</button></div>
                                    </div>
                                </group>
                                <group>
                                    <span class="input-label">Effect</span>
                                    <div class="button-group button-radio-switch-group">
                                        <div><button class="on button-radio-switch" data-deck="2" data-color-effect="add" data-randomiseable>Add</button></div>
                                        <div><button class="button-radio-switch" data-deck="2" data-color-effect="subtract" data-randomiseable>Subtract</button></div>
                                        <div><button class="button-radio-switch" data-deck="2" data-color-effect="multiply" data-randomiseable>Multiply</button></div>
                                    </div>
                                </group>
                            </fieldset>
                        </div>
                        <div class="flex-grid" data-columns="2">
                            <fieldset>
                                <div class="heading">Alpha</div>
                                <group class="flex">
                                    <div class="inline-input">
                                        <span class="input-label">React</span>
                                        <label class="switch">
                                            <input type="checkbox" checked data-deck="2" data-alpha-enabled data-randomiseable>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input grow">
                                        <span class="input-label">Strength</span>
                                        <span class="value">100</span>
                                        <input type="range" min="0" max="100" value="100" step="1" data-deck="2" data-alpha-strength data-randomiseable>
                                    </div>
                                </group>
                                <group>
                                    <span class="input-label">Cause</span>
                                    <div class="button-group button-radio-switch-group">
                                        <div><button class="on button-radio-switch" data-deck="2" data-alpha-cause="average" data-randomiseable>Average</button></div>
                                        <div><button class="button-radio-switch" data-deck="2" data-alpha-cause="percentage" data-randomiseable>Percentage</button></div>
                                    </div>
                                </group>
                                <group>
                                    <span class="input-label">Effect</span>
                                    <div class="button-group button-radio-switch-group">
                                        <div><button class="on button-radio-switch" data-deck="2" data-alpha-effect="add" data-randomiseable>Add</button></div>
                                        <div><button class="button-radio-switch" data-deck="2" data-alpha-effect="subtract" data-randomiseable>Subtract</button></div>
                                        <div><button class="button-radio-switch" data-deck="2" data-alpha-effect="multiply" data-randomiseable>Multiply</button></div>
                                    </div>
                                </group>
                            </fieldset>
                            <fieldset>
                                <div class="heading">Amp</div>
                                <group class="flex">
                                    <div class="inline-input">
                                        <span class="input-label">React</span>
                                        <label class="switch">
                                            <input type="checkbox" checked data-deck="2" data-amp-enabled data-randomiseable>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input grow">
                                        <span class="input-label">Strength</span>
                                        <span class="value">100</span>
                                        <input type="range" min="0" max="100" value="100" step="1" data-deck="2" data-amp-strength data-randomiseable>
                                    </div>
                                </group>
                                <group>
                                    <span class="input-label">Cause</span>
                                    <div class="button-group button-radio-switch-group">
                                        <div><button class="on button-radio-switch" data-deck="2" data-amp-cause="average" data-randomiseable>Average</button></div>
                                        <div><button class="button-radio-switch" data-deck="2" data-amp-cause="percentage" data-randomiseable>Percentage</button></div>
                                    </div>
                                </group>
                                <group>
                                    <span class="input-label">Effect</span>
                                    <div class="button-group button-radio-switch-group">
                                        <div><button class="on button-radio-switch" data-deck="2" data-amp-effect="add" data-randomiseable>Add</button></div>
                                        <div><button class="button-radio-switch" data-deck="2" data-amp-effect="subtract" data-randomiseable>Subtract</button></div>
                                        <div><button class="button-radio-switch" data-deck="2" data-amp-effect="multiply" data-randomiseable>Multiply</button></div>
                                    </div>
                                </group>
                            </fieldset>
                        </div>
                    </div>
                    <div data-tab-panel="randomisation" class="randomisation hide">
                        <div class="effects flex">
                            <fieldset>
                                <div class="heading">Blur</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-blur-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-blur-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                            <fieldset>
                                <div class="heading">Brightness</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-brightness-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-brightness-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                            <fieldset>
                                <div class="heading">Contrast</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-contrast-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-contrast-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                        </div>
                        <div class="effects flex">
                            <fieldset>
                                <div class="heading">Drop-Shadow</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-drop-shadow-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Color</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-drop-shadow-color" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Offset X</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-drop-shadow-offset-x" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Offset Y</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-drop-shadow-offset-y" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Blur</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-drop-shadow-blur" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                        </div>
                        <div class="effects flex">
                            <fieldset>
                                <div class="heading">Grayscale</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-grayscale-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-grayscale-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                            <fieldset>
                                <div class="heading">Hue-Rotate</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-hue-rotate-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-hue-rotate-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                            <fieldset>
                                <div class="heading">Invert</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-invert-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-invert-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                        </div>
                        <div class="effects flex">
                            <fieldset>
                                <div class="heading">Opacity</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-opacity-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-opacity-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                            <fieldset>
                                <div class="heading">Saturate</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-saturate-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-saturate-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                            <fieldset>
                                <div class="heading">Sepia</div>
                                <group>
                                    <div class="inline-input">
                                        <span class="input-label">Enable</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-sepia-toggle" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="inline-input">
                                        <span class="input-label">Value</span>
                                        <label class="switch">
                                            <input type="checkbox" data-deck="2" data-target="data-sepia-value" data-toggle-randomisation>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </group>
                            </fieldset>
                        </div>
                    </div>
                </div>
                <div class="button-group">
                    <div class="relative">
                        <div class="tooltip hide"></div>
                        <button class="pink" data-deck="2" data-send>Send</button>
                    </div>
                    <div class="relative">
                        <div class="tooltip hide"></div>
                        <button class="blue" data-deck="2" data-receive>Receive</button>
                    </div>
                    <div><button class="yellow" data-deck="2" data-save>Save</button></div>
                    <div><button class="green" class="green" data-deck="2" data-randomise>Randomise</button></div>
                </div>
                <div class="button-group">
                    <div><button data-deck="2" data-react>React</button></div>
                    <div><button data-deck="2" data-keyboard>Keyboard</button></div>
                    <div><button data-deck="2" data-guide disabled>Guide</button></div>
                    <div><button class="red" data-deck="2" data-revert>Revert</button></div>
                </div>
            </div>
        </section>
        <div id="modal" class="hide" data-deck>
            <div>
                <button id="modal-close">close</button>
                <div class="settings modal-section">
                    <ul class="tabs">
                        <li><button class="tab active" data-tab-target="keyboard-shortcuts">Keyboard Shortcuts</button></li>
                        <li><button class="tab" data-tab-target="default-midi-assignments">Default MIDI Assignments</button></li>
                        <li><button class="tab" data-tab-target="import-export">Import / Export</button></li>
                        <li><button class="tab" data-tab-target="state-factory-reset">State / Factory Reset</button></li>
                    </ul>
                    <div data-target="keyboard-shortcuts">
                        <ul>
                            <li><kbd>Esc</kbd> <span>Cancel/Close</span></li>

                            <li><kbd>1</kbd><span class="ellipsis">...</span><kbd>2</kbd> <span>Select Preset 1-10</span></li>
                            <li><kbd>-</kbd> <span>Previous Preset</span></li>
                            <li><kbd>-</kbd> <span>Next Preset</span></li>

                            <li><kbd>Shift</kbd> <span>Mirror (Toggle)</span></li>
                            <li><kbd>,</kbd> <span>Mirror Mode - Clip</span></li>
                            <li><kbd>.</kbd> <span>Mirror Mode - Full</span></li>
                            <li><kbd>/</kbd> <span>Mirror Mode - Bleed</span></li>

                            <li><kbd>Enter</kbd> <span>Kaleidoscope (Toggle)</span></li>

                            <li><kbd>↑</kbd> <span>Raise Deck to Top</span></li>
                            <li><kbd>↓</kbd> <span>Lower Deck to Bottom</span></li>
                            <li><kbd>←</kbd> <span>Claim Deck 1</span></li>
                            <li><kbd>→</kbd> <span>Claim Deck 2</span></li>

                            <li><kbd>Space</kbd> <span>Tap BPM</span></li>

                            <li><kbd>Alt</kbd> <span>Previous Composition Mode</span></li>
                            <li><kbd>AltGraph</kbd> <span>Next Composition Mode</span></li>

                            <li><kbd>]</kbd> <span>Assign (Toggle)</span></li>
                            <li><kbd>\</kbd> <span>Record (Toggle)</span></li>
                        </ul>
                    </div>
                    <div data-target="default-midi-assignments" class="hide">
                        <div class="knob-explanations">
                            <div class="knob-explanations-row">
                                <ul class="knob-explanation" data-midi-keyboard-knob="1">
                                    <li class="midi-knob"><label>KNOB</label>1</li>
                                    <li class="midi-data-byte-1"><label>MIDI DATA BYTE 1</label>1</li>
                                    <li class="midi-command"><label>MIDI COMMAND</label>176 (CONTROL CHANGE)</li>
                                    <li class="assignment"><label>ASSIGNMENT</label>REACTIVITY</li>
                                </ul>
                                <ul class="knob-explanation" data-midi-keyboard-knob="2">
                                    <li class="midi-knob"><label>KNOB</label>2</li>
                                    <li class="midi-data-byte-1"><label>MIDI DATA BYTE 1</label>2</li>
                                    <li class="midi-command"><label>MIDI COMMAND</label>176 (CONTROL CHANGE)</li>
                                    <li class="assignment"><label>ASSIGNMENT</label>MIN WIDTH</li>
                                </ul>
                                <ul class="knob-explanation" data-midi-keyboard-knob="3">
                                    <li class="midi-knob"><label>KNOB</label>3</li>
                                    <li class="midi-data-byte-1"><label>MIDI DATA BYTE 1</label>3</li>
                                    <li class="midi-command"><label>MIDI COMMAND</label>176 (CONTROL CHANGE)</li>
                                    <li class="assignment"><label>ASSIGNMENT</label>WIDTH MODE</li>
                                </ul>
                                <ul class="knob-explanation" data-midi-keyboard-knob="4">
                                    <li class="midi-knob"><label>KNOB</label>4</li>
                                    <li class="midi-data-byte-1"><label>MIDI DATA BYTE 1</label>4</li>
                                    <li class="midi-command"><label>MIDI COMMAND</label>176 (CONTROL CHANGE)</li>
                                    <li class="assignment"><label>ASSIGNMENT</label>TRAIL LENGTH</li>
                                </ul>
                            </div>
                            <div class="knob-explanations-row">
                                <ul class="knob-explanation" data-midi-keyboard-knob="5">
                                    <li class="midi-knob"><label>KNOB</label>5</li>
                                    <li class="midi-data-byte-1"><label>MIDI DATA BYTE 1</label>5</li>
                                    <li class="midi-command"><label>MIDI COMMAND</label>176 (CONTROL CHANGE)</li>
                                    <li class="assignment"><label>ASSIGNMENT</label>MODULO</li>
                                </ul>
                                <ul class="knob-explanation" data-midi-keyboard-knob="6">
                                    <li class="midi-knob"><label>KNOB</label>6</li>
                                    <li class="midi-data-byte-1"><label>MIDI DATA BYTE 1</label>6</li>
                                    <li class="midi-command"><label>MIDI COMMAND</label>176 (CONTROL CHANGE)</li>
                                    <li class="assignment"><label>ASSIGNMENT</label>ARC MODE</li>
                                </ul>
                                <ul class="knob-explanation" data-midi-keyboard-knob="7">
                                    <li class="midi-knob"><label>KNOB</label>7</li>
                                    <li class="midi-data-byte-1"><label>MIDI DATA BYTE 1</label>7</li>
                                    <li class="midi-command"><label>MIDI COMMAND</label>176 (CONTROL CHANGE)</li>
                                    <li class="assignment"><label>ASSIGNMENT</label>FILL MODE</li>
                                </ul>
                                <ul class="knob-explanation" data-midi-keyboard-knob="8">
                                    <li class="midi-knob"><label>KNOB</label>8</li>
                                    <li class="midi-data-byte-1"><label>MIDI DATA BYTE 1</label>8</li>
                                    <li class="midi-command"><label>MIDI COMMAND</label>176 (CONTROL CHANGE)</li>
                                    <li class="assignment"><label>ASSIGNMENT</label>COLOR MODE</li>
                                </ul>
                            </div>
                        </div>
                        <div class="midi-keyboard">
                            <ul class="midi-keyboard-knobs">
                                <li data-midi-keyboard-knob="1"></li>
                                <li data-midi-keyboard-knob="2"></li>
                                <li data-midi-keyboard-knob="3"></li>
                                <li data-midi-keyboard-knob="4"></li>
                                <li data-midi-keyboard-knob="5"></li>
                                <li data-midi-keyboard-knob="6"></li>
                                <li data-midi-keyboard-knob="7"></li>
                                <li data-midi-keyboard-knob="8"></li>
                            </ul>
                            <ul class="midi-keyboard-keys">
                                <li data-midi-keyboard-key="c" class="black-after"></li>
                                <li data-midi-keyboard-key="d" class="black-after"></li>
                                <li data-midi-keyboard-key="e"></li>
                                <li data-midi-keyboard-key="f" class="black-after"></li>
                                <li data-midi-keyboard-key="g" class="black-after"></li>
                                <li data-midi-keyboard-key="a" class="black-after"></li>
                                <li data-midi-keyboard-key="b"></li>
                                <li data-midi-keyboard-key="c" class="black-after"></li>
                                <li data-midi-keyboard-key="d" class="black-after"></li>
                                <li data-midi-keyboard-key="e"></li>
                                <li data-midi-keyboard-key="f" class="black-after"></li>
                                <li data-midi-keyboard-key="g" class="black-after"></li>
                                <li data-midi-keyboard-key="a" class="black-after"></li>
                                <li data-midi-keyboard-key="b"></li>
                                <li data-midi-keyboard-key="c"></li>
                            </ul>
                        </div>
                        <div class="key-explanations">
                            <ul class="key-explanation">
                                <li class="note"><label>NOTE</label>C3</li>
                                <li class="midi-note-number"><label>MIDI NOTE NUMBER</label>48</li>
                                <li class="midi-command"><label>MIDI COMMAND</label>144 (NOTE ON)</li>
                                <li class="assignment"><label>ASSIGNMENT</label>LOAD PRESET 1</li>
                            </ul>
                            <ul class="key-explanation">
                                <li class="note"><label>NOTE</label>C♯3</li>
                                <li class="midi-note-number"><label>MIDI NOTE NUMBER</label>49</li>
                                <li class="midi-command"><label>MIDI COMMAND</label>144 (NOTE ON)</li>
                                <li class="assignment"><label>ASSIGNMENT</label>LOAD PRESET 2</li>
                            </ul>
                            <ul class="key-explanation">
                                <li class="note"><label>NOTE</label>D3</li>
                                <li class="midi-note-number"><label>MIDI NOTE NUMBER</label>50</li>
                                <li class="midi-command"><label>MIDI COMMAND</label>144 (NOTE ON)</li>
                                <li class="assignment"><label>ASSIGNMENT</label>LOAD PRESET 3</li>
                            </ul>
                            <ul class="key-explanation">
                                <li class="note">...this continues on, with higher notes loading higher presets</li>
                            </ul>
                        </div>
                    </div>
                    <div data-target="import-export" class="hide">
                        <fieldset data-local-storage-item-key="presets">
                            <label>Presets</label>
                            <form id="presetsFileForm" name="presetsFileForm" enctype="multipart/form-data" method="post">
                                <input type="file" id="presetsFile">
                                <button class="import">Import</button>
                            </form>
                            <button class="export">Export</button>
                            <button class="factoryReset">Factory Reset</button>
                        </fieldset>
                        <fieldset data-local-storage-item-key="assignments">
                            <label>MIDI Assignments</label>
                            <form id="assignmentsFileForm" name="assignmentsFileForm" enctype="multipart/form-data" method="post">
                                <input type="file" id="assignmentsFile">
                                <button class="import">Import</button>
                            </form>
                            <button class="export">Export</button>
                            <button class="factoryReset">Factory Reset</button>
                        </fieldset>
                    </div>
                    <div data-target="state-factory-reset" class="hide">
                        <p>By default, Hydra is ephemeral. This means a page reload will lose all your previous settings/adjustments.
                        To avoid having to repeat the same configurations, you can store a state to load back to, by clicking "Snapshot".</p>

                        <p>Click "Factory reset" to revert to the default state.</p>
                    </div>
                </div>
                <div class="guide modal-section">

                </div>
            </div>
        </div>
        <audio id="audio" crossorigin="anonymous"></audio>
    </div>
    <script>
        window.hydra = (function(){
            return {
                boot: function(settings) {
                    this.markup.init(settings, () => {
                        this.body = document.querySelector('body');

                        this.mixedCanvas = document.getElementById('mixed-canvas');
                        this.mixedCtx = this.mixedCanvas.getContext('2d');

                        this.centerX;
                        this.centerY;

                        this.mouseX;
                        this.mouseY;

                        this.settings = settings;

                        this.audio.init();

                        this.mirrorEnabled = false;
                        this.mirrorMode = 'clip';

                        this.deck1 = this.deck.init(1, (settings.deck1.visual || 'quark'));
                        this.deck2 = this.deck.init(2, (settings.deck2.visual || 'pink'));

                        window.addEventListener('presets-loaded', function(e) {
                            hydra[`deck${e.detail}`].presets.select(settings[`deck${e.detail}`].preset || 1);
                        });

                        this.crossfader.init();
                        this.composition.init();
                        this.effects.init();
                        this.handlers.init();
                        this.modal.init();
                        this.keyboard.init();
                        this.midi.init();

                        this.helpers.detectSizes();

                        this.composition.setMode('overlay');

                        window.onresize = hydra.helpers.detectSizes;
                        this.mouse.init();
                        window.requestAnimationFrame(this.render);
                    });
                },
                markup: {
                    init: function(settings, callback) {
                        // insert base markup here
                        const visualSelectorDropdowns = document.querySelectorAll('.visual-selector');
                        visualSelectorDropdowns.forEach(visualSelectorDropdown => {
                            const selectedVisual = settings[`deck${visualSelectorDropdown.dataset.deck}`].visual;
                            Object.keys(hydra.renderers).sort().forEach(renderer => {
                                if (settings.renderers.includes(renderer)) {
                                    visualSelectorDropdown.add(new Option(renderer, renderer, renderer == selectedVisual, renderer == selectedVisual));
                                }
                            });
                        });

                        if (typeof callback == 'function') {
                            callback();
                        }
                    },
                    injectRendererTabUI: function(deck, name, ui) {
                        // insert renderer tab markup here
                        const uiContainer = document.querySelector(`[data-deck="${deck.id}"].visual-settings`);
                        let markup = hydra.markup.openTabPanel(deck.id, name, null, 'data-tab-panel="renderer"');

                        if (ui.fieldsets) {
                            ui.fieldsets.forEach(fieldset => {
                                markup += hydra.markup.generateFieldset(deck.id, name, fieldset);
                            });
                        }
                        markup += hydra.markup.closeTabPanel();;
                        uiContainer.insertAdjacentHTML('beforeend', markup);
                    },
                    injectRandomisationTabUI: function(deck, name, ui) {
                        // insert renderer-related randomisation markup here
                        const uiContainer = document.querySelector(`[data-deck="${deck.id}"].visual-settings [data-tab-panel="randomisation"]`);
                        let markup = hydra.markup.openTabPanel(deck.id, name, 'renderer');

                        if (ui.fieldsets) {
                            ui.fieldsets.forEach(fieldset => {
                                markup += hydra.markup.generateRandomisationFieldset(deck.id, name, fieldset);
                            });
                        }

                        markup += hydra.markup.closeTabPanel();
                        uiContainer.insertAdjacentHTML('beforeend', markup);
                    },
                    openTabPanel: function(deckId, name, className, attributes) {
                        return `<div ${attributes || ''} data-visual="${name}" data-deck="${deckId}" class="${className || '' } hide">`;
                    },
                    closeTabPanel: function() {
                        return `</div>`;
                    },
                    generateFieldset: function(deckId, name, fieldset) {
                        let markup = `<fieldset>`;

                        if (fieldset.heading) {
                            markup += `<div class="heading">${fieldset.heading}</div>`;
                        }

                        markup += `<group class="${fieldset.class || ''}" ${fieldset.attributes || ''}>`;

                        fieldset.items.forEach(item => {
                            if (item.type == 'group') {
                                markup += `<div class="inline-field-group ${item.class || ''}">`;

                                if (item.heading) {
                                    markup += `<div class="heading">${item.heading}</div>`;
                                }

                                item.items.forEach(groupItem => {
                                    markup += hydra.markup.generateItem(deckId, name, groupItem);
                                });

                                markup += `</div>`;

                            } else {
                                markup += hydra.markup.generateItem(deckId, name, item);
                            }
                        });

                        markup += `</group>
                        </fieldset>`;

                        return markup;
                    },
                    generateCheckboxInput: function(deckId, name, item) {
                        let markup = `<div class="inline-input ${item.containerClass || ''}" data-assignable>`;

                        if (item.label) {
                            markup += `<span class="input-label">${item.label}</span>`;
                        }

                        markup += `<label class="switch">
                                <input type="checkbox" ${item.checked ? 'checked' : ''} class="${item.class || ''}" data-deck="${deckId}" data-visual="${name}"
                                    data-variable="${item.variable}" ${item.randomiseable ? 'data-randomiseable' : ''} ${item.disabled ? 'disabled' : ''}>
                                <span class="slider"></span>
                            </label>
                        </div>`;

                        return markup;
                    },
                    generateRangeOrNumberInput: function(deckId, name, item) {
                        let markup = `<div class="inline-input ${item.containerClass || ''}" data-assignable>`;

                        if (item.label) {
                            markup += `<span class="input-label">${item.label}`;

                            if (item.subLabel) {
                                markup += `<sub>${item.subLabel}</sub>`;
                            }

                            markup += `</span>`;
                        }

                        markup += `<span class="value">${item.value}</span>
                            <input type="${item.type}" min="${item.min}" max="${item.max}" step="${item.step}" value="${item.value}" class="${item.class || ''}"
                                data-deck="${deckId}" data-visual="${name}" data-variable="${item.variable}" ${item.randomiseable ? 'data-randomiseable' : ''}
                                ${item.trigger ? 'data-trigger="' + item.trigger + '"' : ''} ${item.dispatchEvent ? 'data-dispatch-event="' + item.dispatchEvent + '"' : ''}
                                ${item.disabled ? 'disabled' : ''}>
                        </div>`;

                        return markup;
                    },
                    generateColorInput: function(deckId, name, item) {
                        let markup = `<div class="inline-input ${item.containerClass || ''}">`;

                        if (item.label) {
                            markup += `<span class="input-label">${item.label}</span>`;
                        }

                        markup += `<input type="color" value="${item.value}" class="${item.class || ''}" data-deck="${deckId}" data-visual="${name}"
                            data-variable="${item.variable}" ${item.randomiseable ? 'data-randomiseable' : ''} ${item.disabled ? 'disabled' : ''}>
                        </div>`;

                        return markup;
                    },
                    generateButton: function(deckId, name, item) {
                        let markup = `<div class="inline-input ${item.containerClass || ''}" data-assignable>`;

                        if (item.label) {
                            markup += `<span class="input-label">${item.label}</span>`
                        }

                        markup += `<button class="${item.class || ''}" data-deck="${deckId}" data-visual="${name}" data-variable="${item.variable}"
                            data-options="${item.options}" ${item.randomiseable ? 'data-randomiseable' : ''} ${item.trigger ? 'data-trigger="' + item.trigger + '"' : ''}
                            ${item.disabled ? 'disabled' : ''}>${item.text}</button>
                        </div>`;

                        return markup;
                    },
                    generateSelectInput: function(deckId, name, item) {
                        let markup = `<div class="inline-input ${item.containerClass || ''}">`;

                        if (item.label) {
                            markup += `<span class="input-label">${item.label}</span>`;
                        }

                        markup += `<select class="${item.class || ''}" data-deck="${deckId}" data-visual="${name}" data-variable="${item.variable}" ${item.disabled ? 'disabled' : ''}>`;

                        item.options.forEach(option => {
                            markup += `<option value="${option.value}"${option.selected ? ' selected' : ''}>${option.text}</option>`;
                        });

                        markup += `</select>
                        </div>`;

                        return markup;
                    },
                    generateColorMeter: function(deckId, name, item) {
                        let markup = `<div class="inline-input ${item.containerClass || ''}">`;

                        if (item.label) {
                            markup += `<span class="input-label">${item.label}</span>`;
                        }

                        markup += `<div class="color-meter ${item.color}"><div></div></div>
                        </div>`;

                        return markup;
                    },
                    generateEmptySlot: function() {
                        return `<div class="inline-input"></div>`;
                    },
                    generateItem: function(deckId, name, item) {
                        if (item.type == 'checkbox') {
                            return this.generateCheckboxInput(deckId, name, item);
                        }

                        if (item.type == 'range' || item.type == 'number') {
                            return this.generateRangeOrNumberInput(deckId, name, item);
                        }

                        if (item.type == 'color') {
                            return this.generateColorInput(deckId, name, item);
                        }

                        if (item.type == 'button') {
                            return this.generateButton(deckId, name, item);
                        }

                        if (item.type == 'select') {
                            return this.generateSelectInput(deckId, name, item);
                        }

                        if (item.type == 'color-meter') {
                            return this.generateColorMeter(deckId, name, item);
                        }

                        if (item.type == 'empty') {
                            return this.generateEmptySlot();
                        }
                    },
                    generateRandomisationFieldset: function(deckId, name, fieldset) {
                        let markup = `<fieldset>`;

                        if (fieldset.heading) {
                            markup += `<div class="heading">${fieldset.heading}</div>`;
                        }

                        markup += `<group>`;

                        fieldset.items.forEach(item => {
                            if (item.type == 'group') {
                                markup += `<div class="inline-block">`;

                                if (item.heading) {
                                    markup += `<div class="heading">${item.heading}</div>`;
                                }

                                item.items.forEach(groupItem => {
                                    markup += hydra.markup.generateRandomisationToggle(deckId, name, groupItem);
                                });

                                markup += `</div>`;

                            } else {
                                markup += hydra.markup.generateRandomisationToggle(deckId, name, item);
                            }
                        });

                        markup += `</group>
                        </fieldset>`;

                        return markup;
                    },
                    generateRandomisationToggle: function(deckId, name, item) {
                        if (item.type == 'empty') return '';

                        let markup = `<div class="inline-input" data-assignable>`;

                        if (item.label) {
                            markup += `<span class="input-label">${item.label || item.heading || ''}`;

                            if (item.subLabel) {
                                markup += `<sub>${item.subLabel}</sub>`;
                            }

                            markup += `</span>`;
                        }

                        markup += `<label class="switch">
                                <input type="checkbox" ${item.randomiseable ? 'checked' : ''} data-deck="${deckId}" data-visual="${name}"
                                    data-target="${item.variable}" data-toggle-randomisation>
                                <span class="slider"></span>
                            </label>
                        </div>`

                        return markup;
                    }
                },
                deck: {
                    init: function(id, visual) {
                        let deck = {};
                        deck.id = id;
                        deck.canvas = document.getElementById(`deck-${deck.id}-canvas`);
                        deck.ctx = deck.canvas.getContext('2d');
                        deck.pipeCanvas = document.getElementById(`deck-${deck.id}-pipe-canvas`);
                        deck.pipeCtx = deck.pipeCanvas.getContext('2d');
                        deck.crossfaderAlpha = 1;
                        deck.raised = id == 2;
                        deck.scale = 0.75;
                        deck.current = null;
                        deck.visibleTab = 'renderer';

                        deck.visual = {
                            select: function(visual) {
                                deck.ctx.setTransform(1, 0, 0, 1, 0, 0);
                                deck.ctx.clearRect(0, 0, deck.canvas.width, deck.canvas.height);

                                this.current = visual;
                                deck.current = deck[visual];

                                const visualSettingsPanels = document.querySelectorAll(`[data-deck="${deck.id}"].visual-settings > div:not(.effects):not(.reactivity):not(.randomisation)`);
                                visualSettingsPanels.forEach(panel => {
                                    if (deck.visibleTab == 'renderer') {
                                        panel.className = (panel.dataset.deck == deck.id) && (panel.dataset.visual == deck.visual.current) ? 'show' : 'hide';
                                    }
                                });

                                const randomisationRendererPanels = document.querySelectorAll(`[data-deck="${deck.id}"] [data-tab-panel="randomisation"] .renderer`);
                                randomisationRendererPanels.forEach(randomisationRendererPanel => randomisationRendererPanel.classList.add('hide'));

                                const currentRandomisationRendererPanel = document.querySelector(`[data-deck="${deck.id}"] [data-tab-panel="randomisation"] .renderer[data-visual="${visual}"]`);
                                currentRandomisationRendererPanel.classList.remove('hide');

                                deck.reactivity.update();
                                deck.presets.update();
                                deck.randomisation.update();
                            },
                            reset: function() {
                                if (deck.current.presets && deck.current.presets.length) {
                                    deck.presets.select(1);
                                }
                            }
                        }

                        deck.randomisation = {
                            init: function () {
                                this.panel = document.querySelector(`[data-deck="${deck.id}"] [data-tab-panel="randomisation"]`);
                            },
                            update: function() {
                                // TODO - add renderer input specific randomisation options...
                                // let markup = '';
                                // deck.current.inputs.forEach(input => {
                                //     markup += ``;
                                // });
                                // this.panel.innerHTML = markup;

                                const randomisationToggleBtns = document.querySelectorAll(`[data-deck="${deck.id}"] [data-tab-panel="randomisation"] input[type="checkbox"]`);
                                if (randomisationToggleBtns.length) {
                                    randomisationToggleBtns.forEach(randomisationToggleBtn => {
                                        randomisationToggleBtn.addEventListener('input', function(e) {

                                            const target = e.target.dataset.target.startsWith('data-')
                                                ? document.querySelector(`[data-deck="${deck.id}"] [${e.target.dataset.target}]`)
                                                : document.querySelector(`[data-deck="${deck.id}"][data-visual="${deck.visual.current}"][data-variable="${e.target.dataset.target}"]`);
                                            e.target.checked ? target.setAttribute('data-randomiseable', '') : target.removeAttribute('data-randomiseable');
                                        });
                                    });
                                }
                            }
                        }

                        deck.readouts = {
                            init: function() {
                                const variables = document.querySelectorAll(`[data-deck="${deck.id}"][data-variable]`);
                                variables.forEach(variable => {
                                    const displayEl = document.querySelector(`[data-deck-${deck.id}-${variable.dataset.variable}-display]`);
                                    deck[variable.dataset.variable] = variable.value;
                                    if (displayEl) {
                                        displayEl.innerText = hydra.helpers.formatValue(variable.value, variable.dataset.precision || 2);
                                    }
                                    variable.addEventListener('input', function(e) {
                                        deck[variable.dataset.variable] = variable.value;
                                        if (displayEl) {
                                            displayEl.innerText = hydra.helpers.formatValue(variable.value, variable.dataset.precision || 2);
                                        }
                                    });
                                });
                            }
                        }

                        deck.controls = {
                            init: function() {
                                this.visualSelectorDropdown = document.querySelector(`[data-deck="${deck.id}"].visual-selector`);
                                this.visualSelectorDropdown.addEventListener('input', function(e) {
                                    deck.visual.select(e.target.value);
                                });

                                this.sendBtn = document.querySelector(`[data-deck="${deck.id}"][data-send]`);
                                this.sendBtn.addEventListener('click', function(e) {
                                    const tooltip = e.target.closest('.relative').querySelector('.tooltip');
                                    deck.presets.send(tooltip);
                                });

                                this.receiveBtn = document.querySelector(`[data-deck="${deck.id}"][data-receive]`);
                                this.receiveBtn.addEventListener('click', function(e) {
                                    const tooltip = e.target.closest('.relative').querySelector('.tooltip');
                                    deck.presets.receive(tooltip);
                                });

                                this.saveBtn = document.querySelector(`[data-deck="${deck.id}"][data-save]`);
                                this.saveBtn.addEventListener('click', function(e) {
                                    deck.presets.save();
                                });

                                this.randomiseBtn = document.querySelector(`[data-deck="${deck.id}"][data-randomise]`);
                                this.randomiseBtn.addEventListener('click', function(e) {
                                    hydra.helpers.randomise(deck);
                                });

                                this.reactBtn = document.querySelector(`[data-deck="${deck.id}"][data-react]`);
                                this.reactBtn.addEventListener('click', function(e) {
                                    if (!hydra.audio.listening) {
                                        hydra.audio.listen();
                                    }
                                    this.classList.toggle('orange');
                                    deck.reactivity.on = !deck.reactivity.on;
                                });

                                this.keyboardBtn = document.querySelector(`[data-deck="${deck.id}"][data-keyboard]`);
                                this.keyboardBtn.addEventListener('click', function(e) {
                                    if (!e.target.classList.contains('on')) {
                                        document.querySelectorAll(`[data-keyboard]`).forEach(btn => btn.classList.remove('on'));
                                        e.target.classList.add('on');
                                        hydra.keyboard.claimed = deck.id;
                                    } else {
                                        e.target.classList.remove('on');
                                        hydra.keyboard.claimed = false;
                                    }
                                });

                                this.guideBtn = document.querySelector(`[data-deck="${deck.id}"][data-guide]`);
                                this.guideBtn.addEventListener('click', function(e) {
                                    hydra.modal.open('guide');
                                });

                                this.revertBtn = document.querySelector(`[data-deck="${deck.id}"][data-revert]`);
                                this.revertBtn.addEventListener('click', function(e) {
                                    deck.presets.select(deck.presets.current);
                                });

                                this.importBtn = document.querySelector(`[data-deck="${deck.id}"][data-import-presets]`);
                                this.importBtn.addEventListener('click', function(e) {
                                    deck.presets.import();
                                });

                                this.exportBtn = document.querySelector(`[data-deck="${deck.id}"][data-export-presets]`);
                                this.exportBtn.addEventListener('click', function(e) {
                                    deck.presets.export();
                                });

                                this.presetBtns = document.querySelectorAll(`.preset[data-deck="${deck.id}"]`);
                                this.presetBtns.forEach(btn => {
                                    btn.addEventListener('click', function(e) {
                                        if (!e.target.disabled) {
                                            deck.presets.select(e.target.dataset.preset);
                                        }
                                    });
                                });

                                this.prevPresetBtn = document.querySelector(`[data-deck="${deck.id}"][data-previous-preset]`);
                                this.prevPresetBtn.addEventListener('click', function(e) {
                                    deck.presets.previous();
                                });

                                this.nextPresetBtn = document.querySelector(`[data-deck="${deck.id}"][data-next-preset]`);
                                this.nextPresetBtn.addEventListener('click', function(e) {
                                    deck.presets.next();
                                });

                                this.tabBtns = document.querySelectorAll(`[data-deck="${deck.id}"][data-tab]`);
                                this.tabBtns.forEach(tabBtn => {
                                    tabBtn.addEventListener('click', function(e) {
                                        const relatedTabBtns = this.parentElement.parentElement.querySelectorAll(`[data-deck="${deck.id}"][data-tab]`);
                                        relatedTabBtns.forEach(btn => btn.classList.remove('on'));
                                        e.target.classList.add('on');

                                        const tabPanels = document.querySelectorAll(`[data-deck="${deck.id}"] [data-tab-panel]`);
                                        tabPanels.forEach(tabPanel => tabPanel.classList.add('hide'));

                                        const tab = e.target.dataset.tab;
                                        const tabPanel = document.querySelector(tab == 'renderer'
                                            ? `[data-deck="${deck.id}"] [data-tab-panel="${tab}"][data-visual="${deck.visual.current}"]`
                                            : `[data-deck="${deck.id}"] [data-tab-panel="${tab}"]`);
                                        tabPanel.classList.remove('hide');
                                        deck.visibleTab = tab;
                                    });
                                });

                                ['scale', 'color', 'alpha', 'amp'].forEach(reactor => {
                                    this[`${reactor}EnabledToggleBtn`] = document.querySelector(`[data-deck="${deck.id}"][data-${reactor}-enabled]`);
                                    this[`${reactor}EnabledToggleBtn`].addEventListener('click', function(e) {
                                        deck.reactivity[reactor].on = e.target.checked;
                                    });

                                    this[`${reactor}StrengthInput`] = document.querySelector(`[data-deck="${deck.id}"][data-${reactor}-strength]`);
                                    this[`${reactor}StrengthInput`].addEventListener('input', function(e) {
                                        deck.reactivity[reactor].strength = parseInt(e.target.value)/10;
                                        e.target.parentElement.querySelector('.value').textContent = e.target.value;
                                    });

                                    this[`${reactor}CauseToggleBtns`] = document.querySelectorAll(`[data-deck="${deck.id}"][data-${reactor}-cause]`);
                                    this[`${reactor}CauseToggleBtns`].forEach(btn => {
                                        btn.addEventListener('click', function(e) {
                                            deck.controls[`${reactor}CauseToggleBtns`].forEach(btn => btn.classList.remove('on'));
                                            e.target.classList.add('on');
                                            deck.reactivity[reactor].cause = e.target.textContent.toLowerCase();
                                        });
                                    });

                                    this[`${reactor}EffectToggleBtns`] = document.querySelectorAll(`[data-deck="${deck.id}"][data-${reactor}-effect]`);
                                    this[`${reactor}EffectToggleBtns`].forEach(btn => {
                                        btn.addEventListener('click', function(e) {
                                            deck.controls[`${reactor}EffectToggleBtns`].forEach(btn => btn.classList.remove('on'));
                                            e.target.classList.add('on');
                                            deck.reactivity[reactor].effect = e.target.textContent.toLowerCase();
                                        });
                                    });
                                });

                                this.blurToggleBtn = document.querySelector(`[data-deck="${deck.id}"][data-blur-toggle]`);
                                this.blurToggleBtn.addEventListener('click', function(e) {
                                    deck.filters.items.blur.on = e.target.checked;
                                    deck.filters.update();
                                });

                                this.blurValueInput = document.querySelector(`[data-deck="${deck.id}"][data-blur-value]`);
                                this.blurValueInput.addEventListener('input', function(e) {
                                    deck.filters.items.blur.change(parseInt(e.target.value));
                                    e.target.parentElement.querySelector('.value').textContent = e.target.value;
                                })

                                this.brightnessToggleBtn = document.querySelector(`[data-deck="${deck.id}"][data-brightness-toggle]`);
                                this.brightnessToggleBtn.addEventListener('click', function(e) {
                                    deck.filters.items.brightness.on = e.target.checked;
                                    deck.filters.update();
                                });

                                this.brightnessValueInput = document.querySelector(`[data-deck="${deck.id}"][data-brightness-value]`);
                                this.brightnessValueInput.addEventListener('input', function(e) {
                                    deck.filters.items.brightness.change(parseFloat(e.target.value));
                                    e.target.parentElement.querySelector('.value').textContent = e.target.value;
                                })

                                this.contrastToggleBtn = document.querySelector(`[data-deck="${deck.id}"][data-contrast-toggle]`);
                                this.contrastToggleBtn.addEventListener('click', function(e) {
                                    deck.filters.items.contrast.on = e.target.checked;
                                    deck.filters.update();
                                });

                                this.contrastValueInput = document.querySelector(`[data-deck="${deck.id}"][data-contrast-value]`);
                                this.contrastValueInput.addEventListener('input', function(e) {
                                    deck.filters.items.contrast.change(parseFloat(e.target.value));
                                    e.target.parentElement.querySelector('.value').textContent = e.target.value;
                                })

                                this.dropShadowToggleBtn = document.querySelector(`[data-deck="${deck.id}"][data-drop-shadow-toggle]`);
                                this.dropShadowToggleBtn.addEventListener('click', function(e) {
                                    deck.filters.items.dropShadow.on = e.target.checked;
                                    deck.filters.update();
                                });

                                this.dropShadowColorInput = document.querySelector(`[data-deck="${deck.id}"][data-drop-shadow-color]`);
                                this.dropShadowColorInput.addEventListener('input', function(e) {
                                    deck.filters.items.dropShadow.change(
                                        parseInt(deck.controls.dropShadowOffsetXInput.value),
                                        parseInt(deck.controls.dropShadowOffsetYInput.value),
                                        parseInt(deck.controls.dropShadowBlurInput.value),
                                        e.target.value
                                    );
                                })

                                this.dropShadowOffsetXInput = document.querySelector(`[data-deck="${deck.id}"][data-drop-shadow-offset-x]`);
                                this.dropShadowOffsetXInput.addEventListener('input', function(e) {
                                    deck.filters.items.dropShadow.change(
                                        parseInt(e.target.value),
                                        parseInt(deck.controls.dropShadowOffsetYInput.value),
                                        parseInt(deck.controls.dropShadowBlurInput.value),
                                        deck.controls.dropShadowColorInput.value
                                    );
                                    e.target.parentElement.querySelector('.value').textContent = e.target.value;
                                })

                                this.dropShadowOffsetYInput = document.querySelector(`[data-deck="${deck.id}"][data-drop-shadow-offset-y]`);
                                this.dropShadowOffsetYInput.addEventListener('input', function(e) {
                                    deck.filters.items.dropShadow.change(
                                        parseInt(deck.controls.dropShadowOffsetXInput.value),
                                        parseInt(e.target.value),
                                        parseInt(deck.controls.dropShadowBlurInput.value),
                                        deck.controls.dropShadowColorInput.value
                                    );
                                    e.target.parentElement.querySelector('.value').textContent = e.target.value;
                                })

                                this.dropShadowBlurInput = document.querySelector(`[data-deck="${deck.id}"][data-drop-shadow-blur]`);
                                this.dropShadowBlurInput.addEventListener('input', function(e) {
                                    deck.filters.items.dropShadow.change(
                                        parseInt(deck.controls.dropShadowOffsetXInput.value),
                                        parseInt(deck.controls.dropShadowOffsetYInput.value),
                                        parseInt(e.target.value),
                                        deck.controls.dropShadowColorInput.value
                                    );
                                    e.target.parentElement.querySelector('.value').textContent = e.target.value;
                                })

                                this.grayscaleToggleBtn = document.querySelector(`[data-deck="${deck.id}"][data-grayscale-toggle]`);
                                this.grayscaleToggleBtn.addEventListener('click', function(e) {
                                    deck.filters.items.grayscale.on = e.target.checked;
                                    deck.filters.update();
                                });

                                this.grayscaleValueInput = document.querySelector(`[data-deck="${deck.id}"][data-grayscale-value]`);
                                this.grayscaleValueInput.addEventListener('input', function(e) {
                                    deck.filters.items.grayscale.change(parseFloat(e.target.value));
                                    e.target.parentElement.querySelector('.value').textContent = e.target.value;
                                })

                                this.hueRotateToggleBtn = document.querySelector(`[data-deck="${deck.id}"][data-hue-rotate-toggle]`);
                                this.hueRotateToggleBtn.addEventListener('click', function(e) {
                                    deck.filters.items.hueRotate.on = e.target.checked;
                                    deck.filters.update();
                                });

                                this.hueRotateValueInput = document.querySelector(`[data-deck="${deck.id}"][data-hue-rotate-value]`);
                                this.hueRotateValueInput.addEventListener('input', function(e) {
                                    deck.filters.items.hueRotate.change(parseFloat(e.target.value));
                                    e.target.parentElement.querySelector('.value').textContent = e.target.value;
                                })

                                this.invertToggleBtn = document.querySelector(`[data-deck="${deck.id}"][data-invert-toggle]`);
                                this.invertToggleBtn.addEventListener('click', function(e) {
                                    deck.filters.items.invert.on = e.target.checked;
                                    deck.filters.update();
                                });

                                this.invertValueInput = document.querySelector(`[data-deck="${deck.id}"][data-invert-value]`);
                                this.invertValueInput.addEventListener('input', function(e) {
                                    deck.filters.items.invert.change(parseFloat(e.target.value));
                                    e.target.parentElement.querySelector('.value').textContent = e.target.value;
                                })

                                this.opacityToggleBtn = document.querySelector(`[data-deck="${deck.id}"][data-opacity-toggle]`);
                                this.opacityToggleBtn.addEventListener('click', function(e) {
                                    deck.filters.items.opacity.on = e.target.checked;
                                    deck.filters.update();
                                });

                                this.opacityValueInput = document.querySelector(`[data-deck="${deck.id}"][data-opacity-value]`);
                                this.opacityValueInput.addEventListener('input', function(e) {
                                    deck.filters.items.opacity.change(parseFloat(e.target.value));
                                    e.target.parentElement.querySelector('.value').textContent = e.target.value;
                                })

                                this.saturateToggleBtn = document.querySelector(`[data-deck="${deck.id}"][data-saturate-toggle]`);
                                this.saturateToggleBtn.addEventListener('click', function(e) {
                                    deck.filters.items.saturate.on = e.target.checked;
                                    deck.filters.update();
                                });

                                this.saturateValueInput = document.querySelector(`[data-deck="${deck.id}"][data-saturate-value]`);
                                this.saturateValueInput.addEventListener('input', function(e) {
                                    deck.filters.items.saturate.change(parseFloat(e.target.value));
                                    e.target.parentElement.querySelector('.value').textContent = e.target.value;
                                })

                                this.sepiaToggleBtn = document.querySelector(`[data-deck="${deck.id}"][data-sepia-toggle]`);
                                this.sepiaToggleBtn.addEventListener('click', function(e) {
                                    deck.filters.items.sepia.on = e.target.checked;
                                    deck.filters.update();
                                });

                                this.sepiaValueInput = document.querySelector(`[data-deck="${deck.id}"][data-sepia-value]`);
                                this.sepiaValueInput.addEventListener('input', function(e) {
                                    deck.filters.items.sepia.change(parseFloat(e.target.value));
                                    e.target.parentElement.querySelector('.value').textContent = e.target.value;
                                });
                            }
                        }

                        deck.presets = {
                            current: 1,
                            init: function() {
                                this.presetsContainer = document.querySelector(`[data-deck="${deck.id}"].presets`);
                                this.presetBtns = this.presetsContainer.querySelectorAll('.preset');
                            },
                            update: function() {
                                this.clear();

                                if (deck.current.presets && deck.current.presets.length) {
                                    deck.current.presets.forEach((preset, i) => {
                                        deck.controls.presetBtns[i].disabled = false;
                                    });
                                    deck.presets.select(1)
                                } else {
                                    console.debug('no presets found')
                                }
                            },
                            select: function(preset) {
                                if (this.presetsContainer.classList.contains('saving-preset')) {
                                    try {
                                        const currentPresetConfiguration = this.getCurrentPresetConfiguration();

                                        deck.current.presets[preset-1] = currentPresetConfiguration.settings;
                                        // deck[deck.visual.current].presets[preset-1] = presetConfiguration.settings;

                                        this.presetsContainer.classList.remove('saving-preset');

                                        this.select(preset);

                                        this.disableEmpty();

                                    } catch(e) {}

                                } else {
                                    deck.controls.presetBtns.forEach(btn => {
                                        btn.classList.remove('active');
                                    });
                                    deck.controls.presetBtns[preset-1].classList.add('active');
                                    this.current = parseInt(preset);

                                    deck.ctx.setTransform(1, 0, 0, 1, 0, 0);
                                    deck.ctx.clearRect(0, 0, deck.canvas.width, deck.canvas.height);

                                    const selectedPreset = deck.current.presets[preset-1];
                                    this.load(selectedPreset);
                                }
                            },
                            previous: function() {
                                if (deck.current.presets && deck.current.presets.length) {
                                    const previous = this.current == 1 ? deck.current.presets.length : (this.current - 1);
                                    this.select(previous);
                                }
                            },
                            next: function() {
                                if (deck.current.presets && deck.current.presets.length) {
                                    const next = this.current == deck.current.presets.length ? 1 : (this.current + 1);
                                    this.select(next);
                                }
                            },
                            clear: function() {
                                deck.controls.presetBtns.forEach(btn => {
                                    btn.className = 'preset';
                                    btn.disabled = true;
                                });
                            },
                            load: function(preset) {
                                for (const option in preset) {
                                    // TODO get non-renderer variables here too and set them (effects, reactivity, randomisation)
                                    const input = document.querySelector(`[data-visual="${deck.visual.current}"][data-deck="${deck.id}"][data-variable="${option}"]`);

                                    if (!input) {
                                        console.debug(`No input found for: [data-visual="${deck.visual.current}"][data-deck="${deck.id}"][data-variable="${option}"]`)
                                        continue;
                                    }

                                    if (input.type == 'number' || input.type == 'range' || input.type == 'color') {
                                        input.value = preset[option];
                                        input.dispatchEvent(new Event('input', { bubbles: true }));
                                    } else if (input.type == 'checkbox') {
                                        input.checked = preset[option];
                                        input.dispatchEvent(new Event('input', { bubbles: true }));
                                    } else if (input.type == 'submit') {
                                        deck.current[option] = preset[option];
                                        input.textContent = preset[option];
                                    }

                                    if (typeof deck.current.updateDisabledUIComponents == 'function') {
                                        deck.current.updateDisabledUIComponents();
                                    }
                                }
                            },
                            send: function(tooltip) {
                                const currentPresetConfiguration = JSON.stringify(this.getCurrentPresetConfiguration());
                                try {
                                    navigator.clipboard
                                        .writeText(currentPresetConfiguration).then(function() {
                                            console.debug('Preset copied!', currentPresetConfiguration);
                                            deck.presets.displayTooltip(tooltip, 'success', 'Copied to clipboard!');
                                        }, function(err) {
                                            console.error('Could not copy preset: ', err);
                                            deck.presets.displayTooltip(tooltip, 'error', 'Failed to copy to clipboard');
                                        });
                                } catch (err) {
                                    deck.presets.displayTooltip(tooltip, 'error', 'Browser doesn\'t support clipboard API');
                                }
                            },
                            receive: function(tooltip) {
                                try {
                                    navigator.clipboard
                                        .readText().then(function(presetConfiguration) {
                                            presetConfiguration = JSON.parse(presetConfiguration);

                                            if (presetConfiguration.name !== deck.visual.current) {
                                                deck.presets.displayTooltip(tooltip, 'error', 'Preset is not valid for current visual renderer');
                                                throw new Error('Preset is not valid for current visual renderer');
                                            }

                                            deck.presets.load(presetConfiguration.settings);
                                            deck.presets.displayTooltip(tooltip, 'success', 'Loaded from clipboard!');
                                        }, function(err) {
                                            console.error('Could not receive preset: ', err);
                                            deck.presets.displayTooltip(tooltip, 'error', 'Failed to load from clipboard');
                                        });
                                } catch (err) {
                                    deck.presets.displayTooltip(tooltip, 'error', 'Browser doesn\'t support clipboard API');
                                }
                            },
                            save: function() {
                                this.presetsContainer.classList.toggle('saving-preset');

                                if (this.presetsContainer.classList.contains('saving-preset')) {
                                    const length = (deck.current.presets.length < 30) ? deck.current.presets.length + 1 : 30;
                                    [...deck.presets.presetBtns].slice(0, length).forEach(preset => {
                                        preset.disabled = false;
                                    });
                                } else {
                                    this.disableEmpty();
                                }
                            },
                            import: function() {
                                console.debug('importing')
                            },
                            export: function() {
                                const data = JSON.stringify({
                                    renderer: deck.visual.current,
                                    presets: deck.current.presets
                                });
                                hydra.storage.export(data, deck.visual.current + '-presets.json', 'application/json');
                            },
                            getCurrentPresetConfiguration: function() {
                                const currentPresetConfiguration = {
                                    name: deck.visual.current,
                                    settings: {}
                                };
                                deck.current.inputs.forEach(input => {
                                    if (input.type == 'number' || input.type == 'range' || input.type == 'color') {
                                        currentPresetConfiguration.settings[input.dataset.variable] = input.value;
                                    } else if (input.type == 'checkbox') {
                                        currentPresetConfiguration.settings[input.dataset.variable] = input.checked;
                                    } else if (input.type == 'submit') {
                                        currentPresetConfiguration.settings[input.dataset.variable] = input.textContent;
                                    }
                                });
                                return currentPresetConfiguration;
                            },
                            disableEmpty: function() {
                                [...deck.presets.presetBtns].slice(deck.current.presets.length).forEach(preset => {
                                    preset.disabled = true;
                                });
                            },
                            displayTooltip(tooltip, status, message) {
                                tooltip.textContent = message;
                                tooltip.classList.remove('hide', 'transparent');
                                tooltip.classList.add(status);
                                setTimeout(() => {
                                    tooltip.classList.add('transparent');
                                    setTimeout(() => {
                                        tooltip.classList.add('hide');
                                        tooltip.classList.remove(status);
                                    }, 350);
                                }, 2000);
                            }
                        }

                        deck.reactivity = {
                            on: false,
                            defaults: {
                                scale: {
                                    enabled: false,
                                    on: false,
                                    cause: 'average',
                                    effect: 'add',
                                    strength: 10
                                },
                                color: {
                                    enabled: false,
                                    on: false,
                                    cause: 'average',
                                    effect: 'add',
                                    strength: 10
                                },
                                alpha: {
                                    enabled: false,
                                    on: false,
                                    cause: 'average',
                                    effect: 'add',
                                    strength: 10
                                },
                                amp: {
                                    enabled: false,
                                    on: false,
                                    cause: 'average',
                                    effect: 'add',
                                    strength: 10
                                }
                            },
                            adjust: function(type, value) {
                                const strength = deck.reactivity[type].strength;
                                const cause = deck.reactivity[type].cause;
                                const effect = deck.reactivity[type].effect;

                                const impactor = window.hydra.audio[cause];

                                if (effect == 'add') {
                                    return value + (impactor * strength);
                                } else if (effect == 'subtract') {
                                    const adjustedValue = value - (impactor * strength);
                                    return adjustedValue >= 0 ? adjustedValue : 0;
                                } else if (effect == 'multiply') {
                                    return (value/100) * (impactor * strength);
                                }
                            },
                            init: function() {
                                this.inputs = [
                                    deck.controls.scaleStrengthInput,
                                ];
                                this.scale = this.defaults.scale;
                                this.color = this.defaults.color;
                                this.alpha = this.defaults.alpha;
                                this.amp = this.defaults.amp;
                            },
                            update: function() {
                                const currentReactivityConfig = {...deck.reactivity.defaults, ...deck.current.reactivity};
                                for (let option in currentReactivityConfig) {
                                    if (document.querySelector(`[data-deck="${deck.id}"][data-${option}-enabled]`).checked && (!currentReactivityConfig[option].on || !currentReactivityConfig[option].enabled)) {
                                        document.querySelector(`[data-deck="${deck.id}"][data-${option}-enabled]`).click();
                                    }

                                    document.querySelector(`[data-deck="${deck.id}"][data-${option}-enabled]`).disabled = !currentReactivityConfig[option].enabled;
                                    document.querySelector(`[data-deck="${deck.id}"][data-${option}-strength]`).disabled = !currentReactivityConfig[option].enabled;
                                    document.querySelector(`[data-deck="${deck.id}"][data-${option}-cause]`).disabled = !currentReactivityConfig[option].enabled;
                                    document.querySelector(`[data-deck="${deck.id}"][data-${option}-effect]`).disabled = !currentReactivityConfig[option].enabled;

                                    if (currentReactivityConfig[option].enabled) {
                                        document.querySelector(`[data-deck="${deck.id}"][data-${option}-strength]`).value = currentReactivityConfig[option].strength * 10;
                                        document.querySelector(`[data-deck="${deck.id}"][data-${option}-cause="${currentReactivityConfig[option].cause}"]`).click();
                                        document.querySelector(`[data-deck="${deck.id}"][data-${option}-effect="${currentReactivityConfig[option].effect}"]`).click();
                                    }

                                    if (!document.querySelector(`[data-deck="${deck.id}"][data-${option}-enabled]`).checked && currentReactivityConfig[option].enabled && currentReactivityConfig[option].on) {
                                        document.querySelector(`[data-deck="${deck.id}"][data-${option}-enabled]`).click();
                                    }
                                }
                                deck.reactivity.scale = currentReactivityConfig.scale;
                                deck.reactivity.color = currentReactivityConfig.color;
                                deck.reactivity.alpha = currentReactivityConfig.alpha;
                                deck.reactivity.amp = currentReactivityConfig.amp;
                            }
                        }

                        deck.filters = {
                            items: {
                                blur: {
                                    on: false,
                                    label: 'blur',
                                    value: 0,
                                    toggle: function() {
                                        this.on = !this.on;
                                    },
                                    change: function(value) {
                                        this.value = `${value}px`;
                                        deck.filters.update();
                                    }
                                },
                                brightness: {
                                    on: false,
                                    label: 'brightness',
                                    value: 1,
                                    toggle: function() {
                                        this.on = !this.on;
                                    },
                                    change: function(value) {
                                        this.value = value;
                                        deck.filters.update();
                                    }
                                },
                                contrast: {
                                    on: false,
                                    label: 'contrast',
                                    value: 1,
                                    toggle: function() {
                                        this.on = !this.on;
                                    },
                                    change: function(value) {
                                        this.value = value;
                                        deck.filters.update();
                                    }
                                },
                                dropShadow: {
                                    on: false,
                                    label: 'drop-shadow',
                                    value: null,
                                    toggle: function() {
                                        this.on = !this.on;
                                    },
                                    change: function(offsetX, offsetY, blurRadius, color) {
                                        this.value = `${offsetX}px ${offsetY}px ${blurRadius}px ${color}`;
                                        deck.filters.update();
                                    }
                                },
                                grayscale: {
                                    on: false,
                                    label: 'grayscale',
                                    value: 0,
                                    toggle: function() {
                                        this.on = !this.on;
                                    },
                                    change: function(value) {
                                        this.value = value;
                                        deck.filters.update();
                                    }
                                },
                                hueRotate: {
                                    on: false,
                                    label: 'hue-rotate',
                                    value: '0deg',
                                    toggle: function() {
                                        this.on = !this.on;
                                    },
                                    change: function(value) {
                                        this.value = `${value}deg`;
                                        deck.filters.update();
                                    }
                                },
                                invert: {
                                    on: false,
                                    label: 'invert',
                                    value: 0,
                                    toggle: function() {
                                        this.on = !this.on;
                                    },
                                    change: function(value) {
                                        this.value = value;
                                        deck.filters.update();
                                    }
                                },
                                opacity: {
                                    on: false,
                                    label: 'opacity',
                                    value: 1,
                                    toggle: function() {
                                        this.on = !this.on;
                                    },
                                    change: function(value) {
                                        this.value = value;
                                        deck.filters.update();
                                    }
                                },
                                saturate: {
                                    on: false,
                                    label: 'saturate',
                                    value: 1,
                                    toggle: function() {
                                        this.on = !this.on;
                                    },
                                    change: function(value) {
                                        this.value = value;
                                        deck.filters.update();
                                    }
                                },
                                sepia: {
                                    on: false,
                                    label: 'sepia',
                                    value: 0,
                                    toggle: function() {
                                        this.on = !this.on;
                                    },
                                    change: function(value) {
                                        this.value = value;
                                        deck.filters.update();
                                    }
                                }
                            },
                            string: '',
                            update: function() {
                                this.string = 'none';
                                let stringItems = [];
                                let filter;
                                for (let item in deck.filters.items) {
                                    filter =  deck.filters.items[item];
                                    if (filter.on) {
                                        stringItems.push(`${filter.label}(${filter.value})`);
                                    }
                                }
                                if (stringItems.length) {
                                    this.string = stringItems.join(' ');
                                }
                            },
                            apply: function() {
                                deck.pipeCtx.filter = deck.filters.string;
                            },
                            init: function() {
                                this.inputs = [
                                    deck.controls.blurToggleBtn,
                                    deck.controls.blurValueInput,
                                    deck.controls.brightnessToggleBtn,
                                    deck.controls.brightnessValueInput,
                                    deck.controls.contrastToggleBtn,
                                    deck.controls.contrastValueInput,
                                    deck.controls.dropShadowToggleBtn,
                                    deck.controls.dropShadowColorInput,
                                    deck.controls.dropShadowOffsetXInput,
                                    deck.controls.dropShadowOffsetYInput,
                                    deck.controls.dropShadowBlurInput,
                                    deck.controls.grayscaleToggleBtn,
                                    deck.controls.grayscaleValueInput,
                                    deck.controls.hueRotateToggleBtn,
                                    deck.controls.hueRotateValueInput,
                                    deck.controls.invertToggleBtn,
                                    deck.controls.invertValueInput,
                                    deck.controls.opacityToggleBtn,
                                    deck.controls.opacityValueInput,
                                    deck.controls.saturateToggleBtn,
                                    deck.controls.saturateValueInput,
                                    deck.controls.sepiaToggleBtn,
                                    deck.controls.sepiaValueInput,
                                ];
                            }
                        };

                        deck.mouse = {
                            init: function() {
                                deck.mouse.x = 0;
                                deck.mouse.y = 0;
                                deck.mouse.lockedPosition = false;

                                deck.pipeCanvas.addEventListener('click', function() {
                                    deck.mouse.lockedPosition = !deck.mouse.lockedPosition;
                                });
                            }
                        }

                        deck.render = () => {
                            deck.current.render();
                        }

                        deck.presets.init();
                        deck.readouts.init();
                        deck.controls.init();
                        deck.reactivity.init();
                        deck.filters.init();
                        deck.randomisation.init();
                        deck.mouse.init();

                        for (const renderer in hydra.renderers) {
                            deck = hydra.renderers[renderer].init(deck);
                        }

                        deck.visual.select(visual);

                        return deck;
                    }
                },
                renderers: {},
                renderer: {
                    init: function(deck, name, defaults, ui, presets) {
                        // merge any incoming defaults with our initial renderer object
                        deck[name] = {...{}, ...defaults};

                        // fetch our presets (json) via ajax
                        if (presets) {
                            this.importPresets(deck, name, presets);
                        }

                        // inject renderer tab markup here...
                        if (ui) {
                            hydra.markup.injectRendererTabUI(deck, name, ui);
                        }

                        // apply event listeners
                        const inputs = document.querySelectorAll(`[data-deck="${deck.id}"][data-visual="${name}"][data-variable]`);
                        inputs.forEach(input => {

                            deck[name][`${input.dataset.variable}Input`] = input;

                            if (input.type == 'checkbox') {
                                deck[name][input.dataset.variable] = input.checked;

                                input.addEventListener('input', function(e) {
                                    deck[name][input.dataset.variable] = e.target.checked;
                                });
                            } else if (input.type == 'number' || input.type == 'range') {
                                const isInt = (Number.isInteger(input.step) || input.step === undefined);

                                deck[name][input.dataset.variable] = isInt
                                    ? parseInt(input.value)
                                    : parseFloat(input.value);

                                input.addEventListener('input', function(e) {
                                    deck[name][input.dataset.variable] = isInt
                                        ? parseInt(e.target.value)
                                        : parseFloat(e.target.value);
                                    e.target.parentElement.querySelector('.value').textContent = e.target.value;

                                    hydra.helpers.dispatchEvent(deck, name, e.target.dataset.dispatchEvent, 'input')
                                    hydra.helpers.triggerFunction(deck, name, e.target.dataset.trigger);
                                });
                            } else if (input.type == 'color') {
                                deck[name][input.dataset.variable] = hydra.helpers.hexToRgb(input.value);

                                input.addEventListener('input', function(e) {
                                    deck[name][input.dataset.variable] = hydra.helpers.hexToRgb(e.target.value);
                                });
                            } else if (input.type =='submit') {
                                deck[name][input.dataset.variable] = input.textContent;
                                input.options = input.dataset.options?.split(',') || [];

                                input.addEventListener('click', function(e) {
                                    if (input.options.length) {
                                        const index = input.options.indexOf(e.target.textContent);
                                        const option = input.options[index+1] !== undefined ? input.options[index+1] : input.options[0];

                                        deck[name][input.dataset.variable] = option;
                                        input.textContent = option;
                                    }

                                    hydra.helpers.dispatchEvent(deck, name, e.target.dataset.dispatchEvent, 'input')
                                    hydra.helpers.triggerFunction(deck, name, e.target.dataset.trigger);
                                });
                            } else if (input.tagName == 'SELECT') {
                                deck[name][input.dataset.variable] = input.value;

                                input.addEventListener('change', function(e) {
                                    deck[name][input.dataset.variable] = input.value;
                                });
                            }
                        });

                        // insert renderer randomisation markup here
                        if (ui) {
                            hydra.markup.injectRandomisationTabUI(deck, name, ui);
                        }

                        const effectsRandomisationInputs = document.querySelectorAll(`[data-deck="${deck.id}"] [data-tab-panel="randomisation"] .effects input[type="checkbox"]`);
                        const rendererRandomisationInputs = document.querySelectorAll(`[data-deck="${deck.id}"] [data-tab-panel="randomisation"] [data-visual="${name}"].renderer input[type="checkbox"]`);

                        // merge all our possible inputs into the deck
                        deck[name].inputs = [...inputs, ...deck.filters.inputs, ...deck.reactivity.inputs, ...effectsRandomisationInputs, ...rendererRandomisationInputs];

                        return deck[name];
                    },
                    importPresets: function(deck, name, json) {
                        fetch(json)
                            .then((response) => response.json())
                            .then((responseData) => responseData.presets)
                            .then(response => (deck[name].presets = response))
                            .then(response => {
                                if (deck.visual.current == name) {
                                    deck.visual.select(name);
                                    window.dispatchEvent(new CustomEvent('presets-loaded', { detail: deck.id }));
                                }
                            });
                    }
                },
                crossfader: {
                    init: function() {
                        this.display = document.getElementById('crossfader-display');
                        this.input = document.getElementById('crossfader');

                        this.calculateAlphas = (crossfaderValue) => {
                            crossfaderValue = parseFloat(crossfaderValue);
                            hydra.deck1.crossfaderAlpha = 1 - crossfaderValue <= 1 ? 1 - crossfaderValue : 1;
                            hydra.deck2.crossfaderAlpha = 1 + crossfaderValue <= 1 ? 1 + crossfaderValue : 1;
                        };

                        this.updateDisplay = () => {
                            this.display.innerText = `D1 ${hydra.helpers.formatValue(hydra.deck1.crossfaderAlpha, 4)} -.- D2 ${hydra.helpers.formatValue(hydra.deck2.crossfaderAlpha, 4)}`;
                        };

                        this.input.addEventListener('input', function(e) {
                            hydra.crossfader.calculateAlphas(e.target.value);
                            hydra.crossfader.updateDisplay();
                        });

                        this.updateDisplay();

                        return crossfader;
                    }
                },
                composition: {
                    init: function() {
                        this.setMode = (mode) => {
                            hydra.mixedCtx.globalCompositeOperation = mode;
                        };
                        this.previousMode = () => {
                            console.log('previous mode');
                        };
                        this.nextMode = () => {
                            console.log('next mode');
                        };
                    }
                },
                effects: {
                    init: function() {
                        this.kaleidoscope = {};

                        this.kaleidoscope.output = {
                            enabled: false,
                            angle: 68,
                            toggle: document.getElementById('kaleidoscope-output-toggle')
                        };
                        this.kaleidoscope.deck1 = {
                            enabled: false,
                            angle: 68,
                            toggle: document.getElementById('kaleidoscope-deck1-toggle')
                        };
                        this.kaleidoscope.deck2 = {
                            enabled: false,
                            angle: 68,
                            toggle: document.getElementById('kaleidoscope-deck2-toggle')
                        };

                        this.kaleidoscope.sliderContainers = document.querySelectorAll('.kaleidoscope-slider-container');
                        this.kaleidoscope.toggles = document.querySelectorAll('.kaleidoscope-toggle');
                        this.kaleidoscope.angleInputs = document.querySelectorAll('.kaleidoscope-angle');

                        this.kaleidoscope.clip = (ctx, canvas) => {
                            ctx.save();

                            ctx.beginPath();
                            ctx.moveTo(canvas.width/2, canvas.height/2);
                            ctx.lineTo(canvas.width,0);
                            ctx.lineTo(canvas.width/2, 0);
                            ctx.closePath();
                            ctx.clip();
                        };

                        this.kaleidoscope.apply = (ctx, canvas, angle) => {
                            ctx.restore();

                            ctx.save();
                            ctx.translate(0, 0);
                            ctx.beginPath();
                            ctx.moveTo(canvas.width/2, canvas.height/2);
                            ctx.lineTo(canvas.width, canvas.height/2);
                            ctx.lineTo(canvas.width, 0);
                            ctx.lineTo(canvas.width/2, 0);
                            ctx.closePath();
                            ctx.clip();

                            ctx.save();
                            ctx.translate(canvas.width/2, canvas.height/2);
                            ctx.rotate((Math.PI / 180) * -angle);
                            ctx.translate(-canvas.width/2, -canvas.height/2);
                            ctx.scale(1,-1);
                            ctx.drawImage(canvas, 0, -canvas.height);
                            ctx.scale(1,-1);

                            ctx.drawImage(canvas, 0, canvas.height);
                            ctx.restore();
                            ctx.restore();

                            ctx.save();
                            ctx.scale(1,-1);
                            ctx.drawImage(canvas, 0, -canvas.height);
                            ctx.restore();

                            ctx.save();
                            ctx.translate(canvas.width, 0);
                            ctx.scale(-1,1);
                            ctx.drawImage(canvas, 0, 0);
                            ctx.restore();
                        }

                        this.kaleidoscope.toggles.forEach(toggle => {
                            toggle.addEventListener('click', function(e) {
                                const target = e.target.dataset.target;
                                const angleInput = e.target.parentElement.parentElement.parentElement.querySelector('.kaleidoscope-angle');
                                const sliderContainer = e.target.parentElement.parentElement.parentElement.querySelector('.kaleidoscope-slider-container');
                                e.target.classList.toggle('on');
                                hydra.effects.kaleidoscope[target].enabled = e.target.classList.contains('on');
                                sliderContainer.classList.toggle('disabled');

                                if (hydra.effects.kaleidoscope[target].enabled && hydra.effects.mirror[target].enabled) {
                                    hydra.effects.mirror[target].toggle.dispatchEvent(new Event('click', { bubbles: true }));
                                }
                            });
                        });

                        this.kaleidoscope.angleInputs.forEach(angleInput => {
                            angleInput.addEventListener('input', function(e) {
                                const target = e.target.dataset.target;
                                hydra.effects.kaleidoscope[target].angle = parseFloat(e.target.value);
                                e.target.parentElement.querySelector('.value').textContent = e.target.value;
                            });
                        });

                        this.mirror = {}

                        this.mirror.output = {
                            enabled: false,
                            mode: 'clip',
                            toggle: document.getElementById('mirror-output-toggle')
                        };
                        this.mirror.deck1 = {
                            enabled: false,
                            mode: 'clip',
                            toggle: document.getElementById('mirror-deck1-toggle')
                        };
                        this.mirror.deck2 = {
                            enabled: false,
                            mode: 'clip',
                            toggle: document.getElementById('mirror-deck2-toggle')
                        };

                        this.mirror.toggles = document.querySelectorAll('.mirror-toggle');
                        this.mirror.mirrorModeBtns = document.querySelectorAll('.mirror-mode');

                        this.mirror.clip = (ctx, canvas, mode) => {
                            ctx.save();

                            if (mode == 'clip') {
                                ctx.beginPath();
                                ctx.moveTo(canvas.width/2, 0);
                                ctx.lineTo(canvas.width, 0);
                                ctx.lineTo(canvas.width, canvas.height);
                                ctx.lineTo(canvas.width/2, canvas.height);
                                ctx.closePath();
                                ctx.clip();
                            }

                            if (mode == 'full') {
                                ctx.beginPath();
                                ctx.moveTo(canvas.width/2, 0);
                                ctx.lineTo(canvas.width, 0);
                                ctx.lineTo(canvas.width, canvas.height/2);
                                ctx.lineTo(canvas.width/2, canvas.height/2);
                                ctx.closePath();
                                ctx.clip();
                            }
                        };

                        this.mirror.apply = (ctx, canvas, mode) => {
                            if (mode == 'clip' || mode == 'full') {
                                ctx.restore();
                            }

                            if (mode == 'full') {
                                ctx.save();
                                ctx.translate(0, canvas.height);
                                ctx.scale(1,-1);
                                ctx.globalCompositeOperation = 'multiply';
                                ctx.drawImage(canvas, 0, 0);
                                ctx.restore();
                            }

                            ctx.save();
                            ctx.translate(canvas.width, 0);
                            ctx.scale(-1,1);
                            ctx.globalCompositeOperation = 'multiply';
                            ctx.drawImage(canvas, 0, 0);
                            ctx.restore();
                        }

                        this.mirror.toggles.forEach(toggle => {
                            toggle.addEventListener('click', function(e) {
                                const target = e.target.dataset.target;
                                const mirrorMode = e.target.parentElement.parentElement.querySelector('.mirror-mode');
                                e.target.classList.toggle('on');
                                hydra.effects.mirror[target].enabled = e.target.classList.contains('on');

                                const mirrorCycleBtnsContainer = e.target.parentElement.parentElement.parentElement.querySelector('.mirror-mode-buttons-container');
                                mirrorCycleBtnsContainer.classList.toggle('disabled');

                                if (hydra.effects.mirror[target].enabled && hydra.effects.kaleidoscope[target].enabled) {
                                    hydra.effects.kaleidoscope[target].toggle.dispatchEvent(new Event('click', { bubbles: true }));
                                }
                            });
                        });

                        this.mirror.mirrorModeBtns.forEach(mirrorMode => {
                            mirrorMode.addEventListener('click', function(e) {
                                const mirrorModeBtns = e.target.parentElement.parentElement.querySelectorAll('.mirror-mode')
                                mirrorModeBtns.forEach(btn => {
                                    btn.classList.remove('clip','full','bleed');
                                });
                                const target = e.target.dataset.target;
                                hydra.effects.mirror[target].mode = e.target.textContent;
                                e.target.classList.add(e.target.textContent);
                            });
                        });
                    }
                },
                handlers: {
                    init: function() {
                        const deckResetBtns = document.querySelectorAll('.reset');
                        deckResetBtns.forEach(btn => {
                            btn.addEventListener('click', function(e) {
                                hydra[`deck${e.target.dataset.deck}`].visual.reset();
                            });
                        })

                        const raiseToTopBtns = document.querySelectorAll('.raise-to-top');
                        raiseToTopBtns.forEach(btn => {
                            btn.addEventListener('click', function(e) {
                                raiseToTopBtns.forEach(button => {
                                    button.classList.remove('raised');
                                });
                                e.target.classList.add('raised');
                                if (e.target.dataset.deck == 1) {
                                    hydra.deck1.raised = true;
                                    hydra.deck2.raised = false;
                                } else {
                                    hydra.deck1.raised = false;
                                    hydra.deck2.raised = true;
                                }
                            });
                        });

                        const modeInput = document.getElementById('composition-mode-selector');
                        modeInput.addEventListener('input', function(e) {
                            hydra.mixedCtx.globalCompositeOperation = e.target.value;
                        });

                        const settingsOpenBtn = document.getElementById('modal-open');
                        settingsOpenBtn.addEventListener('click', function(e) {
                            hydra.modal.open('settings');
                        });

                        const modalCloseBtn = document.getElementById('modal-close');
                        modalCloseBtn.addEventListener('click', function(e) {
                            hydra.modal.close();
                        });

                        const recordBtn = document.getElementById('record');
                        recordBtn.addEventListener('click', function(e) {
                            if (!hydra.recorder.initialised) {
                                hydra.recorder.init(hydra.mixedCanvas, 5000000);
                            }
                            if (e.target.textContent == 'Record') {
                                hydra.recorder.start();
                                e.target.textContent = 'Stop';
                            } else {
                                hydra.recorder.stop();
                                e.target.textContent = 'Record';
                            }
                        });

                        const tapBpmBtn = document.getElementById('tap-bpm');
                        tapBpmBtn.addEventListener('click', function(e) {
                            hydra.audio.bpm.calculate();
                        });

                        const syncBtn = document.getElementById('sync');
                        syncBtn.addEventListener('click', function(e) {
                            hydra.audio.bpm.sync();
                        });

                        const assignBtn = document.getElementById('assign');
                        assignBtn.addEventListener('click', function(e) {
                            if (hydra.body.classList.contains('assigning')) {
                                hydra.midi.cancelAssignment();
                            } else {
                                hydra.body.classList.add('assigning');
                            }
                        });

                        const assignableInputs = document.querySelectorAll('[data-assignable]');
                        assignableInputs.forEach(assignableInput => {
                            assignableInput.addEventListener('mousedown', function(e) {
                                if (hydra.body.classList.contains('assigning')) {
                                    assignableInput.assigning = true;
                                    hydra.body.classList.add('selected');
                                }
                            });
                        });
                    }
                },
                modal: {
                    isOpen: false,
                    init: function() {
                        this.element = document.getElementById('modal');

                        const tabs = this.element.querySelectorAll('.tab');
                        tabs.forEach(tab => {
                            tab.addEventListener('click', function(e) {
                                const tabTarget = e.target.dataset.tabTarget;

                                const relatedTabs = e.target.closest('.tabs').querySelectorAll('.tab');
                                relatedTabs.forEach(tab => tab.classList.remove('active'));

                                e.target.classList.add('active');

                                const section = e.target.closest('.modal-section');
                                const sections = section.querySelectorAll(':scope > div');
                                sections.forEach(section => section.classList.add('hide'));
                                section.querySelector(`[data-target="${tabTarget}"]`).classList.remove('hide');
                            });
                        });
                    },
                    open: function(section) {
                        this.element.classList.remove('hide');
                        this.element.querySelectorAll('.modal-section').forEach(section => {
                            section.classList.add('hide');
                        });
                        this.element.querySelector(`.${section}`).classList.remove('hide');
                        this.isOpen = true;
                    },
                    close: function() {
                        this.element.classList.add('hide');
                        this.isOpen = false;
                    }
                },
                mouse: {
                    init: function() {
                        window.onmousemove = (e) => {
                            hydra.mouseX = e.clientX;
                            hydra.mouseY = e.clientY;

                            if (!hydra.deck1.mouse.lockedPosition) {
                                hydra.deck1.mouse.x = hydra.mouseX;
                                hydra.deck1.mouse.y = hydra.mouseY;
                            }

                            if (!hydra.deck2.mouse.lockedPosition) {
                                hydra.deck2.mouse.x = hydra.mouseX;
                                hydra.deck2.mouse.y = hydra.mouseY;
                            }
                        };
                    }
                },
                render: function() {
                    hydra.deck1.ctx.globalAlpha = hydra.deck1.alpha;
                    hydra.deck2.ctx.globalAlpha = hydra.deck2.alpha;

                    hydra.mixedCtx.clearRect(0, 0, hydra.mixedCanvas.width, hydra.mixedCanvas.height);
                    if (!hydra.deck1.current.clearsSelf) {
                        hydra.deck1.ctx.clearRect(0, 0, hydra.mixedCanvas.width, hydra.mixedCanvas.height);
                    }
                    hydra.deck1.pipeCtx.clearRect(0, 0, hydra.deck1.pipeCanvas.width, hydra.deck1.pipeCanvas.height);
                    if (!hydra.deck2.current.clearsSelf) {
                        hydra.deck2.ctx.clearRect(0, 0, hydra.mixedCanvas.width, hydra.mixedCanvas.height);
                    }
                    hydra.deck2.pipeCtx.clearRect(0, 0, hydra.deck2.pipeCanvas.width, hydra.deck2.pipeCanvas.height);

                    hydra.deck1.render();
                    if (hydra.effects.kaleidoscope.deck1.enabled) {
                        hydra.effects.kaleidoscope.clip(hydra.deck1.pipeCtx, hydra.deck1.pipeCanvas);
                    }
                    if (hydra.effects.mirror.deck1.enabled) {
                        hydra.effects.mirror.clip(hydra.deck1.pipeCtx, hydra.deck1.pipeCanvas, hydra.effects.mirror.deck1.mode);
                    }
                    hydra.deck1.pipeCtx.save();
                    hydra.deck1.filters.apply();
                    hydra.deck1.pipeCtx.drawImage(hydra.deck1.canvas, 0, 0);
                    hydra.deck1.pipeCtx.restore();
                    if (hydra.effects.kaleidoscope.deck1.enabled) {
                        hydra.effects.kaleidoscope.apply(hydra.deck1.pipeCtx, hydra.deck1.pipeCanvas, hydra.effects.kaleidoscope.deck1.angle);
                    }
                    if (hydra.effects.mirror.deck1.enabled) {
                        hydra.effects.mirror.apply(hydra.deck1.pipeCtx, hydra.deck1.pipeCanvas, hydra.effects.mirror.deck1.mode);
                    }

                    hydra.deck2.render();
                    if (hydra.effects.kaleidoscope.deck2.enabled) {
                        hydra.effects.kaleidoscope.clip(hydra.deck2.pipeCtx, hydra.deck2.pipeCanvas);
                    }
                    if (hydra.effects.mirror.deck2.enabled) {
                        hydra.effects.mirror.clip(hydra.deck2.pipeCtx, hydra.deck2.pipeCanvas, hydra.effects.mirror.deck2.mode);
                    }
                    hydra.deck2.pipeCtx.save();
                    hydra.deck2.filters.apply();
                    hydra.deck2.pipeCtx.drawImage(hydra.deck2.canvas, 0, 0);
                    hydra.deck2.pipeCtx.restore();
                    if (hydra.effects.kaleidoscope.deck2.enabled) {
                        hydra.effects.kaleidoscope.apply(hydra.deck2.pipeCtx, hydra.deck2.pipeCanvas, hydra.effects.kaleidoscope.deck2.angle);
                    }
                    if (hydra.effects.mirror.deck2.enabled) {
                        hydra.effects.mirror.apply(hydra.deck2.pipeCtx, hydra.deck2.pipeCanvas, hydra.effects.mirror.deck2.mode);
                    }


                    if (hydra.effects.kaleidoscope.output.enabled) {
                        hydra.effects.kaleidoscope.clip(hydra.mixedCtx, hydra.mixedCanvas);
                    }

                    if (hydra.effects.mirror.output.enabled) {
                        hydra.effects.mirror.clip(hydra.mixedCtx, hydra.mixedCanvas, hydra.effects.mirror.output.mode);
                    }

                    if (hydra.deck1.raised) {
                        hydra.mixedCtx.globalAlpha = hydra.deck1.crossfaderAlpha;
                        hydra.mixedCtx.drawImage(hydra.deck1.pipeCanvas, 0, 0);
                        hydra.mixedCtx.globalAlpha = 1;
                    }

                    hydra.mixedCtx.globalAlpha = hydra.deck2.crossfaderAlpha;
                    hydra.mixedCtx.drawImage(hydra.deck2.pipeCanvas, 0, 0);
                    hydra.mixedCtx.globalAlpha = 1;

                    if (!hydra.deck1.raised) {
                        hydra.mixedCtx.globalAlpha = hydra.deck1.crossfaderAlpha;
                        hydra.mixedCtx.drawImage(hydra.deck1.pipeCanvas, 0, 0);
                        hydra.mixedCtx.globalAlpha = 1;
                    }

                    if (hydra.effects.kaleidoscope.output.enabled) {
                        hydra.effects.kaleidoscope.apply(hydra.mixedCtx, hydra.mixedCanvas, hydra.effects.kaleidoscope.output.angle);
                    }

                    if (hydra.effects.mirror.output.enabled) {
                        hydra.effects.mirror.apply(hydra.mixedCtx, hydra.mixedCanvas, hydra.effects.mirror.output.mode);
                    }

                    if (!hydra.audio.listening) {
                        hydra.audio.knightrider();
                    }

                    hydra.audio.bpm.beatDetection();

                    window.requestAnimationFrame(hydra.render);
                },
                audio: {
                    average: 0,
                    percentage: 0,
                    bpm: {
                        current: null,
                        syncPoint: null,
                        beatsFromSyncPoint: null,
                        beatDuration: null,
                        beatOn: false,
                        display: document.querySelector('[data-bpm-display]'),
                        calculationProperties: {
                            init: function() {
                                this.beatTimestamps = [];
                                this.shouldClear = false;
                            },
                            interval: null,
                        },
                        beatDetection: function() {
                            if (hydra.audio.bpm.syncPoint && hydra.audio.bpm.beatDuration && !hydra.audio.bpm.beatsFromSyncPoint) {
                                hydra.audio.bpm.beatsFromSyncPoint = 1;
                            }
                            if (hydra.audio.bpm.beatsFromSyncPoint && (hydra.audio.bpm.syncPoint + (hydra.audio.bpm.beatsFromSyncPoint * hydra.audio.bpm.beatDuration)) <= Date.now()) {
                                hydra.audio.bpm.beatOn = true;
                                hydra.audio.bpm.beatsFromSyncPoint++;
                            } else if (hydra.audio.bpm.beatOn) {
                                hydra.audio.bpm.beatOn = false;
                            }
                        },
                        sync: function() {
                            if (hydra.audio.bpm.syncPoint) {
                                hydra.audio.bpm.beatOn = true;
                                hydra.audio.bpm.syncPoint = Date.now();
                                hydra.audio.bpm.beatsFromSyncPoint = 1;
                            }
                        },
                        calculate: function() {
                            clearInterval(hydra.audio.bpm.calculationProperties.interval);
                            if (hydra.audio.bpm.calculationProperties.shouldClear) {
                                hydra.audio.bpm.calculationProperties.init();
                            }
                            hydra.audio.bpm.beatOn = true;

                            const now = Date.now();
                            const msInMin = 60000;
                            hydra.audio.bpm.calculationProperties.beatTimestamps.push(now);
                            const numberOfBeats = hydra.audio.bpm.calculationProperties.beatTimestamps.length;
                            const x = numberOfBeats - 1;
                            const y = hydra.audio.bpm.calculationProperties.beatTimestamps[x] - hydra.audio.bpm.calculationProperties.beatTimestamps[0];

                            const bpm = msInMin * x / y;

                            if (numberOfBeats >= 2) {
                                hydra.audio.bpm.current = bpm.toFixed(2).toString().padStart(6, ' ');
                                hydra.audio.bpm.display.textContent = hydra.audio.bpm.current;
                            }

                            hydra.audio.bpm.syncPoint = now;
                            hydra.audio.bpm.beatDuration = msInMin / bpm;
                            hydra.audio.bpm.beatsFromSyncPoint = 1;

                            hydra.audio.bpm.calculationProperties.interval = setInterval(function() {
                                hydra.audio.bpm.calculationProperties.shouldClear = true;
                            }, 2200);
                        }
                    },
                    listening: false,
                    init: function() {
                        this.meterCanvas = document.getElementById('audio-meter');
                        this.meterCtx = this.meterCanvas.getContext('2d');
                        this.bpm.calculationProperties.init();
                    },
                    listen: function() {
                        try {
                            navigator.mediaDevices.getUserMedia({
                                audio: true
                            }).then(this.configureMediaProcessing);
                            this.listening = true;
                        } catch (err) {
                            // bad things happened... weird browser, lacking ssl?
                        }
                    },
                    configureMediaProcessing: function(stream) {
                        hydra.audio.context = new AudioContext();
                        hydra.audio.source = hydra.audio.context.createMediaStreamSource(stream);
                        hydra.audio.processor = hydra.audio.context.createScriptProcessor(1024, 1, 1);
                        hydra.audio.analyser = hydra.audio.context.createAnalyser();

                        hydra.audio.analyser.smoothingTimeConstant = 0.8;
                        hydra.audio.analyser.fftSize = 512;

                        hydra.audio.source.connect(hydra.audio.analyser);
                        hydra.audio.analyser.connect(hydra.audio.processor);
                        hydra.audio.processor.connect(hydra.audio.context.destination);

                        hydra.audio.processor.onaudioprocess = () => {
                            const array = new Uint8Array(hydra.audio.analyser.frequencyBinCount);
                            let values = 0;
                            const length = array.length;

                            hydra.audio.analyser.getByteFrequencyData(array);

                            for (let i = 0; i < length; i++) {
                                values += (array[i]);
                            }

                            hydra.audio.average = values / hydra.audio.analyser.frequencyBinCount;
                            hydra.audio.percentage = (100 / hydra.audio.analyser.frequencyBinCount) * hydra.audio.average;

                            hydra.audio.showLevels();
                        }
                    },
                    showLevels: function() {
                        this.meterCtx.clearRect(0, 0, this.meterCanvas.width, this.meterCanvas.height);

                        this.meterCtx.save();
                        const gradient = this.meterCtx.createLinearGradient(0, 0, this.meterCanvas.width, 0);

                        gradient.addColorStop(0, '#76b14c');
                        gradient.addColorStop(0.5, '#76b14c');
                        gradient.addColorStop(0.75, '#c6b13d');
                        gradient.addColorStop(1, '#e62323');

                        this.meterCtx.fillStyle = gradient;

                        this.meterCtx.fillRect(0, 0 , ((this.meterCanvas.width / 100) * (hydra.audio.percentage*3)), 60);
                        this.meterCtx.restore();

                        this.meterCtx.fillStyle = '#0d0d0d';
                        let divisions = 60;
                        for (let i = 0; i < divisions; i++) {
                            this.meterCtx.fillRect((this.meterCanvas.width / divisions) * i, 0 , 3, 60);
                        }
                    },
                    knightrider: function() {
                        hydra.audio.meterCtx.clearRect(0, 0, hydra.audio.meterCanvas.width, hydra.audio.meterCanvas.height);

                        hydra.audio.meterCtx.save();

                        hydra.audio.meterCtx.fillStyle = '#540707';

                        const x = hydra.helpers.sine(Date.now(), (hydra.audio.meterCanvas.width+60)*5)

                        hydra.audio.meterCtx.fillRect((x/5)-50, 0 , 50, 60);
                        hydra.audio.meterCtx.restore();

                        hydra.audio.meterCtx.fillStyle = '#0d0d0d';
                        let divisions = 60;
                        for (let i = 0; i < divisions; i++) {
                            hydra.audio.meterCtx.fillRect((hydra.audio.meterCanvas.width / divisions) * i, 0 , 3, 60);
                        }
                    }
                },
                recorder: {
                    initialised: false,
                    init: function(canvas, videoBitsPerSecond) {
                        this.mediaSource = new MediaSource();
                        this.mediaRecorder;
                        this.recordedBlobs;
                        this.sourceBuffer;
                        this.stream = canvas.captureStream();
                        this.options = {
                            mimeType: this.getSupportedType(),
                            videoBitsPerSecond: videoBitsPerSecond || 2500000 // 2.5Mbps
                        };
                        this.initialised = true;
                    },
                    getSupportedType: function() {
                        const types = [
                            'video/mpeg\;codecs=h264',
                            'video/webm\;codecs=h264',
                            'video/webm',
                            'video/webm,codecs=vp9',
                            'video/vp8',
                            'video/webm\;codecs=vp8',
                            'video/webm\;codecs=daala',
                            'video/mpeg'
                        ];
                        let supportedType = null;

                        for (let i in types) {
                            if (MediaRecorder.isTypeSupported(types[i])) {
                                supportedType = types[i];
                                break;
                            }
                        }

                        return supportedType;
                    },
                    handleDataAvailable: function(event) {
                        if (event.data && event.data.size > 0) {
                            hydra.recorder.recordedBlobs.push(event.data);
                        }
                    },
                    handleStop: function(event) {
                        console.debug('Recorder stopped: ', event);
                        hydra.recorder.download();
                    },
                    start: function() {
                        hydra.recorder.recordedBlobs = [];
                        try {
                            hydra.recorder.mediaRecorder = new MediaRecorder(hydra.recorder.stream, hydra.recorder.options);
                        } catch (e0) {
                            console.debug('Unable to create MediaRecorder with options Object: ', e0);
                            try {
                                hydra.recorder.options = {mimeType: 'video/webm,codecs=vp9'};
                                hydra.recorder.mediaRecorder = new MediaRecorder(hydra.recorder.stream, hydra.recorder.options);
                            } catch (e1) {
                                console.debug('Unable to create MediaRecorder with options Object: ', e1);
                                try {
                                    hydra.recorder.options = 'video/vp8'; // Chrome 47
                                    hydra.recorder.mediaRecorder = new MediaRecorder(hydra.recorder.stream, hydra.recorder.options);
                                } catch (e2) {
                                    console.error('MediaRecorder is not supported by this browser.\n\n' +
                                        'Try Firefox 29 or later, or Chrome 47 or later, ' +
                                        'with Enable experimental Web Platform features enabled from chrome://flags.');
                                    console.error('Exception while creating MediaRecorder:', e2);
                                    return;
                                }
                            }
                        }
                        console.debug('Created MediaRecorder', hydra.recorder.mediaRecorder, 'with options', hydra.recorder.options);
                        hydra.recorder.mediaRecorder.onstop = hydra.recorder.handleStop;
                        hydra.recorder.mediaRecorder.ondataavailable = hydra.recorder.handleDataAvailable;
                        hydra.recorder.mediaRecorder.start(100); // collect 100ms of data
                        console.debug('MediaRecorder started', hydra.recorder.mediaRecorder);
                    },
                    stop: function() {
                        hydra.recorder.mediaRecorder.stop();
                    },
                    download: function() {
                        const blob = new Blob(hydra.recorder.recordedBlobs, {type: 'video/webm'});
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.style.display = 'none';
                        a.href = url;
                        a.download = 'hydra.webm';
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(() => {
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);
                        }, 100);
                    }
                },
                storage: {
                    init: function() {
                        this.db = window.localStorage;
                        // this.db.clear();

                        if (!this.db.getItem('presets')) {
                            this.db.setItem('presets', JSON.stringify(presets.collection));
                            this.db.setItem('presetsDefault', JSON.stringify(presets.collection));
                        } else {
                            presets.collection = JSON.parse(this.db.getItem('presets'));
                        }

                        if (!this.db.getItem('assignments')) {
                            this.db.setItem('assignments', JSON.stringify(midi.assignments));
                            this.db.setItem('assignmentsDefault', JSON.stringify(midi.assignments));
                        } else {
                            midi.assignments = JSON.parse(this.db.getItem('assignments'));
                        }
                    },
                    db: null,
                    dataToImport: {},
                    import: function() {
                        let input = this.dataToImport.input;
                        if (typeof window.FileReader !== 'function') {
                            console.error("The file API isn't supported on this browser yet.");
                            return;
                        } else if (!input.files) {
                            console.error("This browser doesn't seem to support the `files` property of file inputs.");
                        } else if (!input.files[0]) {
                            console.error("Please select a file before clicking 'Import'.");
                        } else if (input.files[0].type != 'application/json') {
                            console.error("File selected for import is not a valid JSON file.");
                        } else {
                            let file = input.files[0];
                            let fr = new FileReader();
                            fr.onload = this.loadFile;
                            fr.readAsText(file);
                        }
                    },
                    loadFile: function(e) {
                        let data = e.target.result;

                        try {

                            switch(storage.dataToImport.itemKey) {
                                case 'presets':
                                    storage.db.setItem('presets', data);
                                    presets.collection = JSON.parse(storage.db.getItem('presets'));
                                    break;
                                case 'assignments':
                                    storage.db.setItem('assignments', data);
                                    midi.assignments = JSON.parse(storage.db.getItem('assignments'));
                                    break;
                            }

                            storage.dataToImport.input.value = '';

                            console.error('Imported successfully.');

                        } catch(e) {
                            console.error('There was a problem importing the selected file.');
                        }

                    },
                    export: function(content, fileName, contentType) {
                        let file = new Blob([content], {type: contentType});
                        let a = document.createElement('a');
                        a.href = URL.createObjectURL(file);
                        a.download = fileName;
                        a.click();
                        URL.revokeObjectURL(a.href);
                    }
                },
                keyboard: {
                    claimed: false,
                    whitelist: [
                        'Escape',
                        'ArrowLeft',
                        'ArrowRight',
                        '§',
                        ']',
                        '\\',
                        ',',
                        '.',
                        '/',
                        ' ',
                        'Alt',
                        'AltGraph',
                        'Enter',
                        'Shift',
                    ],
                    init: function() {
                        window.addEventListener('keydown', function(e) {
                            if (!hydra.keyboard.claimed && !hydra.keyboard.whitelist.includes(e.key)) {
                                return;
                            }
                            console.debug(e.key);
                            switch (e.key) {
                                case '§':
                                case ']':
                                    if (!hydra.midi.assigning) {
                                        document.getElementById('assign').click();
                                    }
                                    break;
                                case 'Escape':
                                    if (hydra.body.classList.contains('assigning')) {
                                        hydra.midi.cancelAssignment();
                                    }
                                    if (hydra.modal.isOpen) {
                                        document.getElementById('modal-close').click();
                                    }
                                    const savingPreset = document.querySelector('.saving-preset');
                                    if (savingPreset) {
                                        const deck = savingPreset.dataset.deck;
                                        document.querySelector(`[data-deck="${deck}"][data-save]`).click();
                                    }
                                    break;
                                // case 'q':
                                //     knobs.valueChange('reactivity', 'up');
                                //     break;
                                // case 'a':
                                //     knobs.valueChange('reactivity', 'down');
                                //     break;
                                // case 'w':
                                //     knobs.valueChange('minWidth', 'up');
                                //     break;
                                // case 's':
                                //     knobs.valueChange('minWidth', 'down');
                                //     break;
                                // case 'e':
                                //     knobs.valueChange('widthMode', 'up');
                                //     break;
                                // case 'd':
                                //     knobs.valueChange('widthMode', 'down');
                                //     break;
                                // case 'r':
                                //     knobs.valueChange('trailLength', 'up');
                                //     break;
                                // case 'f':
                                //     knobs.valueChange('trailLength', 'down');
                                //     break;
                                // case 't':
                                //     knobs.valueChange('modulo', 'up');
                                //     break;
                                // case 'g':
                                //     knobs.valueChange('modulo', 'down');
                                //     break;
                                // case 'y':
                                //     knobs.valueChange('arcMode', 'up');
                                //     break;
                                // case 'h':
                                //     knobs.valueChange('arcMode', 'down');
                                //     break;
                                // case 'u':
                                //     knobs.valueChange('fillMode', 'up');
                                //     break;
                                // case 'j':
                                //     knobs.valueChange('fillMode', 'down');
                                //     break;
                                // case 'i':
                                //     knobs.valueChange('colorMode', 'up');
                                //     break;
                                // case 'k':
                                //     knobs.valueChange('colorMode', 'down');
                                //     break;
                                // case 'o':
                                //     knobs.valueChange('globalShift', 'up');
                                //     break;
                                // case 'l':
                                //     knobs.valueChange('globalShift', 'down');
                                //     break;
                                // case 'p':
                                //     knobs.valueChange('globalAlpha', 'up');
                                //     break;
                                // case ';':
                                //     knobs.valueChange('globalAlpha', 'down');
                                //     break;
                                // case '[':
                                //     knobs.valueChange('globalAmp', 'up');
                                //     break;
                                // case '\'':
                                //     knobs.valueChange('globalAmp', 'down');
                                //     break;
                                case 'Backspace':
                                    console.log('what to do?');
                                    break;
                                case '\\':
                                    document.getElementById('record').click();
                                    break;
                                case '1':
                                    hydra[`deck${hydra.keyboard.claimed}`].presets.select(1);
                                    break;
                                case '2':
                                    hydra[`deck${hydra.keyboard.claimed}`].presets.select(2);
                                    break;
                                case '3':
                                    hydra[`deck${hydra.keyboard.claimed}`].presets.select(3);
                                    break;
                                case '4':
                                    hydra[`deck${hydra.keyboard.claimed}`].presets.select(4);
                                    break;
                                case '5':
                                    hydra[`deck${hydra.keyboard.claimed}`].presets.select(5);
                                    break;
                                case '6':
                                    hydra[`deck${hydra.keyboard.claimed}`].presets.select(6);
                                    break;
                                case '7':
                                    hydra[`deck${hydra.keyboard.claimed}`].presets.select(7);
                                    break;
                                case '8':
                                    hydra[`deck${hydra.keyboard.claimed}`].presets.select(8);
                                    break;
                                case '9':
                                    hydra[`deck${hydra.keyboard.claimed}`].presets.select(9);
                                    break;
                                case '0':
                                    hydra[`deck${hydra.keyboard.claimed}`].presets.select(10);
                                    break;
                                case '-':
                                    hydra[`deck${hydra.keyboard.claimed}`].presets.previous();
                                    break;
                                case '=':
                                    hydra[`deck${hydra.keyboard.claimed}`].presets.next();
                                    break;
                                // case '`':
                                //     neuromute.state.toggle();
                                //     break;
                                // case 'z':
                                //     audio.react.toggle();
                                //     break;
                                // case 'x':
                                //     audio.react.set('reactor', 'width');
                                //     break;
                                // case 'c':
                                //     audio.react.set('reactor', 'shift');
                                //     break;
                                // case 'v':
                                //     audio.react.set('reactor', 'alpha');
                                //     break;
                                // case 'b':
                                //     audio.react.set('reactor', 'amp');
                                //     break;
                                // case 'n':
                                //     audio.react.set('cause', 'average');
                                //     break;
                                // case 'm':
                                //     audio.react.set('cause', 'percentage');
                                //     break;
                                case ',':
                                    const mirrorClipBtn = !hydra.keyboard.claimed
                                        ? '[data-target="output"].mirror-mode.applies-clip'
                                        : `[data-target="deck${hydra.keyboard.claimed}"].mirror-mode.applies-clip`;
                                    document.querySelector(mirrorClipBtn).click();
                                    break;
                                case '.':
                                    const mirrorFullBtn = !hydra.keyboard.claimed
                                        ? '[data-target="output"].mirror-mode.applies-full'
                                        : `[data-target="deck${hydra.keyboard.claimed}"].mirror-mode.applies-full`;
                                    document.querySelector(mirrorFullBtn).click();
                                    break;
                                case '/':
                                    const mirrorBleedBtn = !hydra.keyboard.claimed
                                        ? '[data-target="output"].mirror-mode.applies-bleed'
                                        : `[data-target="deck${hydra.keyboard.claimed}"].mirror-mode.applies-bleed`;
                                    document.querySelector(mirrorBleedBtn).click();
                                    break;
                                case 'ArrowUp':
                                    document.querySelector(`[data-deck="${hydra.keyboard.claimed}"].raise-to-top`).click();
                                    break;
                                case 'ArrowDown':
                                    document.querySelector(`[data-deck="${hydra.keyboard.claimed == 1 ? 2 : 1}"].raise-to-top`).click();
                                    break;
                                case 'ArrowLeft':
                                    document.querySelector('[data-deck="1"][data-keyboard]').click();
                                    break;
                                case 'ArrowRight':
                                    document.querySelector('[data-deck="2"][data-keyboard]').click();
                                    break;
                                case ' ':
                                    document.getElementById('tap-bpm').click();
                                    break;
                                case 'Alt':
                                    hydra.composition.previousMode();  // TODO
                                    break;
                                case 'AltGraph':
                                    hydra.composition.nextMode();  // TODO
                                    break;
                                case 'Enter':
                                    const kaleidoscopeToggleBtn = !hydra.keyboard.claimed
                                        ? 'kaleidoscope-output-toggle'
                                        : `kaleidoscope-deck${hydra.keyboard.claimed}-toggle`;
                                    document.getElementById(kaleidoscopeToggleBtn).click();
                                    break;
                                case 'Shift':
                                    const mirrorToggleBtn = !hydra.keyboard.claimed
                                        ? 'mirror-output-toggle'
                                        : `mirror-deck${hydra.keyboard.claimed}-toggle`;
                                    document.getElementById(mirrorToggleBtn).click();
                                    break;
                            }
                        });
                    }
                },
                midi: {
                    assigning: false,
                    init: function() {
                        this.requestAccess();
                    },
                    requestAccess: function() {
                        try {
                            navigator.requestMIDIAccess()
                                .then(this.onMIDISuccess, this.onMIDIFailure);
                        } catch (err) {
                            // bad things happened... weird browser, lacking ssl?
                        }
                    },
                    onMIDISuccess: function(midiAccess) {
                        for (let input of midiAccess.inputs.values()) {
                            input.onmidimessage = hydra.midi.getMIDIMessage;
                        }
                    },
                    onMIDIFailure: function() {
                        console.debug('Could not access MIDI devices.');
                    },
                    getMIDIMessage: function(midiMessage) {

                        switch (midiMessage.data[0]) {
                            //pad or key
                            case 144:
                                try {
                                    presets.select(midiMessage.data[1] - 47);
                                } catch (e) {}
                                break;
                            // dial
                            case 176:
                                if (knobs.assigning) {
                                    midi.assignments.knobs[midiMessage.data[1]] = knobs.assigning;
                                    storage.db.setItem('assignments', JSON.stringify(midi.assignments));
                                    knobs.cancelAssignment();
                                } else {
                                    try {
                                        let dial = midi.assignments.knobs[parseInt(midiMessage.data[1])],
                                            min = knobs.knob[dial]._input.min,
                                            max = knobs.knob[dial]._input.max,
                                            incrementSize = (Math.abs(min - max)/127);

                                        if (Math.sign(min) == -1) {
                                            knobs.knob[dial].value = (incrementSize - Math.abs(min) - incrementSize) + (incrementSize * midiMessage.data[2]);
                                        } else {
                                            knobs.knob[dial].value = (knobs.knob[dial]._input.max/127) * midiMessage.data[2];
                                        }
                                    } catch (e) {}
                                }
                                break;

                        }

                    },
                    cancelAssignment: function() {
                        hydra.body.classList.remove('assigning');
                        hydra.body.classList.remove('selected');
                        hydra.midi.assigning = false;
                    },
                    assignments: {
                        knobs: {
                            1: 'reactivity',
                            2: 'minWidth',
                            3: 'widthMode',
                            4: 'trailLength',
                            5: 'modulo',
                            6: 'arcMode',
                            7: 'fillMode',
                            8: 'colorMode',
                        }
                    }
                },
                helpers: {
                    sine: function(count, iterations) {
                        count = (180/(iterations/2)) * count;
                        return iterations/2 + Math.cos((count)*Math.PI/180)*iterations/2;
                    },
                    hexToRgb: function(hex) {
                        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                        return result ? {
                            r: parseInt(result[1], 16),
                            g: parseInt(result[2], 16),
                            b: parseInt(result[3], 16)
                        } : null;
                    },
                    formatValue: function(value, precision) {
                        const n = 10 * (10 * precision);
                        return (Math.round(value * n) / n).toFixed(precision);
                    },
                    detectSizes: function() {
                        //// This is for full size screen - cpu gets hammered at 4k!
                        // hydra.deck1.canvas.width = window.innerWidth;
                        // hydra.deck1.canvas.height = window.innerHeight;

                        // hydra.mixedCanvas.width = window.innerWidth;
                        // hydra.mixedCanvas.height = window.innerHeight;

                        // hydra.deck2.canvas.width = window.innerWidth;
                        // hydra.deck2.canvas.height = window.innerHeight;

                        // hydra.centerX = window.innerWidth/2;
                        // hydra.centerY = window.innerHeight/2;

                        hydra.deck1.canvas.width = hydra.deck1.pipeCanvas.getBoundingClientRect().width;
                        hydra.deck1.canvas.height = hydra.deck1.pipeCanvas.getBoundingClientRect().height;

                        hydra.deck1.pipeCanvas.width = hydra.deck1.pipeCanvas.getBoundingClientRect().width;
                        hydra.deck1.pipeCanvas.height = hydra.deck1.pipeCanvas.getBoundingClientRect().height;

                        hydra.mixedCanvas.width = hydra.mixedCanvas.getBoundingClientRect().width;
                        hydra.mixedCanvas.height = hydra.mixedCanvas.getBoundingClientRect().height;

                        hydra.deck2.canvas.width = hydra.deck2.pipeCanvas.getBoundingClientRect().width;
                        hydra.deck2.canvas.height = hydra.deck2.pipeCanvas.getBoundingClientRect().height;

                        hydra.deck2.pipeCanvas.width = hydra.deck2.pipeCanvas.getBoundingClientRect().width;
                        hydra.deck2.pipeCanvas.height = hydra.deck2.pipeCanvas.getBoundingClientRect().height;

                        // hydra.audio.meterCanvas.width = (hydra.audio.meterCanvas.getBoundingClientRect().width
                        //     - parseInt(getComputedStyle(hydra.audio.meterCanvas).marginLeft)
                        //     - parseInt(getComputedStyle(hydra.audio.meterCanvas).marginRight)
                        // );
                        hydra.audio.meterCanvas.width = hydra.audio.meterCanvas.getBoundingClientRect().width;
                        hydra.audio.meterCanvas.height = hydra.audio.meterCanvas.getBoundingClientRect().height;

                        hydra.centerX = hydra.deck1.canvas.width/2;
                        hydra.centerY = hydra.deck1.canvas.height/2;

                        const sliderHeight = document.querySelector('.extend').clientHeight - document.getElementById('sliders').clientHeight - 65;

                        document.querySelectorAll('.deck-alpha').forEach((slider, i) => {
                            slider.style.width = `${sliderHeight}px`;
                            slider.style.top = `${sliderHeight/2}px`;
                            if (i == 0) {
                                slider.style.left =`-${sliderHeight/2 - 39 - 15}px`;
                            } else {
                                slider.style.right =`-${sliderHeight/2 - 39 - 15}px`;
                            }
                        });
                    },
                    randomise: function(deck) {
                        let inputs;

                        deck.ctx.setTransform(1, 0, 0, 1, 0, 0);
                        deck.ctx.clearRect(0, 0, deck.canvas.width, deck.canvas.height);

                        const countDecimals = (number) => {
                            if ((number % 1) != 0)
                                return number.toString().split(".")[1].length;
                            return 0;
                        }

                        const randomValue = (min, max, precision) => {
                            if (Math.random() > 0.5) {
                                const number = Math.random() * (max - min + 1) + min;
                                const multiplier = Math.pow(10, precision || 0);
                                return Math.round(number * multiplier) / multiplier;
                            } else {
                                let number = Math.random() * (max - min) + min;
                                number = parseFloat(number.toFixed(countDecimals(precision)));
                                if (precision == 0) {
                                    number = Math.round(number);
                                }
                                return number;
                            }
                        }

                        const randomColor = () => {
                            return '#'+(Math.random() * 0xFFFFFF << 0).toString(16).padStart(6, '0');
                        }

                        deck.current.inputs.forEach(function(input) {
                            if (typeof input.dataset.randomiseable !== 'undefined') {
                                if (Math.random() > 0.25) {
                                    if (input.type == 'number' || input.type == 'range') {
                                        const min = parseFloat(input.min) || 0;
                                        const max = parseFloat(input.max) || 1000;
                                        const step = parseFloat(input.step) || 1;
                                        const randomisedValue = randomValue(min, max, step);
                                        input.value = randomisedValue;
                                    } else if (input.type == 'checkbox') {
                                        const randomisedValue = randomValue(0, 1, 0);
                                        input.checked = randomisedValue;
                                    } else if (input.type == 'color') {
                                        input.value = randomColor();
                                    }

                                    if (input.type == 'submit') {
                                        input.dispatchEvent(new Event('click', { bubbles: true }));
                                    } else if (input.type == 'checkbox') {
                                        input.dispatchEvent(new Event('click', { bubbles: true }));
                                        input.dispatchEvent(new Event('input', { bubbles: true }));
                                    } else {
                                        input.dispatchEvent(new Event('input', { bubbles: true }));
                                    }
                                }
                            }
                        });
                    },
                    dispatchEvent: function(deck, visual, property, type) {
                        if (property) {
                            deck[visual][property].dispatchEvent(new Event(type, { bubbles: true }));
                        }
                    },
                    triggerFunction: function(deck, visual, fn) {
                        if (fn) {
                            deck[visual][fn]();
                        }
                    }
                }
            }
        })();
    </script>
    <script src="./js/renderers/lockdown/renderer.js"></script>
    <script src="./js/renderers/matrix/renderer.js"></script>
    <script src="./js/renderers/neuromute/renderer.js"></script>
    <script src="./js/renderers/pink/renderer.js"></script>
    <script src="./js/renderers/strobe/renderer.js"></script>
    <script src="./js/renderers/quark/renderer.js"></script>
    <script>
        hydra.boot({
            id: 'hydra',
            themes: [
                'cyberpunk',
                'default',
                'high-contrast',
                'matrix'
            ],
            renderers: [
                'lockdown',
                'matrix',
                'neuromute',
                'pink',
                'quark',
                'strobe'
            ],
            deck1: {
                visual: 'quark',
                preset: 3
            },
            deck2: {
                visual: 'lockdown',
                preset: 6
            }
        });
    </script>
</body>

</html>
